/*
 jquery-timepicker v1.11.5 - A jQuery timepicker plugin inspired by Google Calendar. It supports both mouse and keyboard navigation.
 Copyright (c) 2016 Jon Thornton - http://jonthornton.github.com/jquery-timepicker/
 License: MIT
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(c){return c.raw=c};$jscomp.createTemplateTagFirstArgWithRaw=function(c,a){c.raw=a;return c};$jscomp.findInternal=function(c,a,b){c instanceof String&&(c=String(c));for(var d=c.length,e=0;e<d;e++){var f=c[e];if(a.call(b,f,e,c))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,a,b){if(c==Array.prototype||c==Object.prototype)return c;c[a]=b.value;return c};
$jscomp.getGlobal=function(c){c=["object"==typeof globalThis&&globalThis,c,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var a=0;a<c.length;++a){var b=c[a];if(b&&b.Math==Math)return b}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(c,a){var b=$jscomp.propertyToPolyfillSymbol[a];if(null==b)return c[a];b=c[b];return void 0!==b?b:c[a]};$jscomp.polyfill=function(c,a,b,d){a&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(c,a,b,d):$jscomp.polyfillUnisolated(c,a,b,d))};
$jscomp.polyfillUnisolated=function(c,a,b,d){b=$jscomp.global;c=c.split(".");for(d=0;d<c.length-1;d++){var e=c[d];if(!(e in b))return;b=b[e]}c=c[c.length-1];d=b[c];a=a(d);a!=d&&null!=a&&$jscomp.defineProperty(b,c,{configurable:!0,writable:!0,value:a})};
$jscomp.polyfillIsolated=function(c,a,b,d){var e=c.split(".");c=1===e.length;d=e[0];d=!c&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var h=e[f];if(!(h in d))return;d=d[h]}e=e[e.length-1];b=$jscomp.IS_SYMBOL_NATIVE&&"es6"===b?d[e]:null;a=a(b);null!=a&&(c?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:a}):a!==b&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&(b=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+b+"$"+e),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:a})))};$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6","es3");$jscomp.polyfill("Object.is",function(c){return c?c:function(a,b){return a===b?0!==a||1/a===1/b:a!==a&&b!==b}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(c){return c?c:function(a,b){var d=this;d instanceof String&&(d=String(d));var e=d.length;b=b||0;for(0>b&&(b=Math.max(b+e,0));b<e;b++){var f=d[b];if(f===a||Object.is(f,a))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(c,a,b){if(null==c)throw new TypeError("The 'this' value for String.prototype."+b+" must not be null or undefined");if(a instanceof RegExp)throw new TypeError("First argument to String.prototype."+b+" must not be a regular expression");return c+""};$jscomp.polyfill("String.prototype.includes",function(c){return c?c:function(a,b){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,b||0)}},"es6","es3");
$jscomp.polyfill("String.prototype.repeat",function(c){return c?c:function(a){var b=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var d="";a;)if(a&1&&(d+=b),a>>>=1)b+=b;return d}},"es6","es3");$jscomp.stringPadding=function(c,a){c=void 0!==c?String(c):" ";return 0<a&&c?c.repeat(Math.ceil(a/c.length)).substring(0,a):""};
$jscomp.polyfill("String.prototype.padStart",function(c){return c?c:function(a,b){var d=$jscomp.checkStringArgs(this,null,"padStart");return $jscomp.stringPadding(b,a-d.length)+d}},"es8","es3");
!function(c){"object"==typeof exports&&exports&&"object"==typeof module&&module&&module.exports===exports?c(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],c):c(jQuery)}(function(c){function a(g){g=g[0];return 0<g.offsetWidth&&0<g.offsetHeight}function b(g){if(g.minTime&&(g.minTime=y(g.minTime)),g.maxTime&&(g.maxTime=y(g.maxTime)),g.durationTime&&"function"!=typeof g.durationTime&&(g.durationTime=y(g.durationTime)),"now"==g.scrollDefault)g.scrollDefault=function(){return g.roundingFunction(y(new Date),
g)};else if(g.scrollDefault&&"function"!=typeof g.scrollDefault){var m=g.scrollDefault;g.scrollDefault=function(){return g.roundingFunction(y(m),g)}}else g.minTime&&(g.scrollDefault=function(){return g.roundingFunction(g.minTime,g)});if("string"===c.type(g.timeFormat)&&g.timeFormat.match(/[gh]/)&&(g._twelveHourTime=!0),!1===g.showOnFocus&&-1!=g.showOn.indexOf("focus")&&g.showOn.splice(g.showOn.indexOf("focus"),1),0<g.disableTimeRanges.length){for(var l in g.disableTimeRanges)g.disableTimeRanges[l]=
[y(g.disableTimeRanges[l][0]),y(g.disableTimeRanges[l][1])];g.disableTimeRanges=g.disableTimeRanges.sort(function(r,v){return r[0]-v[0]});for(l=g.disableTimeRanges.length-1;0<l;l--)g.disableTimeRanges[l][0]<=g.disableTimeRanges[l-1][1]&&(g.disableTimeRanges[l-1]=[Math.min(g.disableTimeRanges[l][0],g.disableTimeRanges[l-1][0]),Math.max(g.disableTimeRanges[l][1],g.disableTimeRanges[l-1][1])],g.disableTimeRanges.splice(l,1))}return g}function d(g){var m=g.data("timepicker-settings"),l=g.data("timepicker-list");
if(l&&l.length&&(l.remove(),g.data("timepicker-list",!1)),m.useSelect)var r=l=c("<select />",{"class":"ui-timepicker-select"});else l=c("<ul />",{"class":"ui-timepicker-list"}),r=c("<div />",{"class":"ui-timepicker-wrapper",tabindex:-1}),r.css({display:"none",position:"absolute"}).append(l);if(m.noneOption)if(!0===m.noneOption&&(m.noneOption=m.useSelect?"Time...":"None"),c.isArray(m.noneOption))for(var v in m.noneOption){if(parseInt(v,10)==v){var A=e(m.noneOption[v],m.useSelect);l.append(A)}}else A=
e(m.noneOption,m.useSelect),l.append(A);(m.className&&r.addClass(m.className),null===m.minTime&&null===m.durationTime||!m.showDuration)||("function"==typeof m.step?"function":m.step,r.addClass("ui-timepicker-with-duration"),r.addClass("ui-timepicker-step-"+m.step));A=m.minTime;"function"==typeof m.durationTime?A=y(m.durationTime()):null!==m.durationTime&&(A=m.durationTime);v=null!==m.minTime?m.minTime:0;var G=null!==m.maxTime?m.maxTime:v+C-1;v>G&&(G+=C);G===C-1&&"string"===c.type(m.timeFormat)&&m.show2400&&
(G=C);var K=m.disableTimeRanges,I=0,Q=K.length,N=m.step;"function"!=typeof N&&(N=function(){return m.step});for(var O=0;G>=v;O++,v+=60*N(O)){var L=v,M=D(L,m);if(m.useSelect)var J=c("<option />",{value:M});else J=c("<li />"),J.addClass(43200>L%86400?"ui-timepicker-am":"ui-timepicker-pm"),J.data("time",86400>=L?L:L%86400);J.text(M);if((null!==m.minTime||null!==m.durationTime)&&m.showDuration)if(M=H(v-A,m.step),m.useSelect)J.text(J.text()+" ("+M+")");else{var P=c("<span />",{"class":"ui-timepicker-duration"});
P.text(" ("+M+")");J.append(P)}Q>I&&(L>=K[I][1]&&(I+=1),K[I]&&L>=K[I][0]&&L<K[I][1]&&(m.useSelect?J.prop("disabled",!0):J.addClass("ui-timepicker-disabled")));l.append(J)}(r.data("timepicker-input",g),g.data("timepicker-list",r),m.useSelect)?(g.val()&&l.val(f(y(g.val()),m)),l.on("focus",function(){c(this).data("timepicker-input").trigger("showTimepicker")}),l.on("blur",function(){c(this).data("timepicker-input").trigger("hideTimepicker")}),l.on("change",function(){u(g,c(this).val(),"select")}),u(g,
l.val(),"initial"),g.hide().after(l)):(v=m.appendTo,"string"==typeof v?v=c(v):"function"==typeof v&&(v=v(g)),v.append(r),q(g,l),l.on("mousedown click","li",function(R){g.off("focus.timepicker");g.on("focus.timepicker-ie-hack",function(){g.off("focus.timepicker-ie-hack");g.on("focus.timepicker",F.show)});k(g)||g[0].focus();l.find("li").removeClass("ui-timepicker-selected");c(this).addClass("ui-timepicker-selected");B(g)&&(g.trigger("hideTimepicker"),l.on("mouseup.timepicker click.timepicker","li",
function(S){l.off("mouseup.timepicker click.timepicker");r.hide()}))}))}function e(g,m){var l,r,v;return"object"==typeof g?(l=g.label,r=g.className,v=g.value):"string"==typeof g?l=g:c.error("Invalid noneOption value"),m?c("<option />",{value:v,"class":r,text:l}):c("<li />",{"class":r,text:l}).data("time",String(v))}function f(g,m){return g=m.roundingFunction(g,m),null!==g?D(g,m):void 0}function h(g){g.target!=window&&(g=c(g.target),g.closest(".ui-timepicker-input").length||g.closest(".ui-timepicker-wrapper").length||
(F.hide(),c(document).unbind(".ui-timepicker"),c(window).unbind(".ui-timepicker")))}function k(g){g=g.data("timepicker-settings");return(window.navigator.msMaxTouchPoints||"ontouchstart"in document)&&g.disableTouchKeyboard}function p(g,m,l){if(!l&&0!==l)return!1;g=g.data("timepicker-settings");var r=!1;l=g.roundingFunction(l,g);return m.find("li").each(function(v,A){v=c(A);if("number"==typeof v.data("time"))return v.data("time")==l?(r=v,!1):void 0}),r}function q(g,m){m.find("li").removeClass("ui-timepicker-selected");
var l=y(t(g),g.data("timepicker-settings"));null!==l&&(g=p(g,m,l))&&(l=g.offset().top-m.offset().top,(l+g.outerHeight()>m.outerHeight()||0>l)&&m.scrollTop(m.scrollTop()+g.position().top-g.outerHeight()),g.addClass("ui-timepicker-selected"))}function n(g,m){if(""!==this.value&&"timepicker"!=m){var l=c(this);if(!l.is(":focus")||g&&"change"==g.type){g=l.data("timepicker-settings");var r=y(this.value,g);if(null===r)return void l.trigger("timeFormatError");var v=!1;if(null!==g.minTime&&null!==g.maxTime&&
(r<g.minTime||r>g.maxTime)&&(v=!0),c.each(g.disableTimeRanges,function(){return r>=this[0]&&r<this[1]?(v=!0,!1):void 0}),g.forceRoundTime){var A=g.roundingFunction(r,g);A!=r&&(r=A,m=null)}g=D(r,g);v?u(l,g,"error")&&l.trigger("timeRangeError"):u(l,g,m)}}}function t(g){return g.is("input")?g.val():g.data("ui-timepicker-value")}function u(g,m,l){if(g.is("input")){g.val(m);var r=g.data("timepicker-settings");r.useSelect&&"select"!=l&&"initial"!=l&&g.data("timepicker-list").val(f(y(m),r))}return g.data("ui-timepicker-value")!=
m?(g.data("ui-timepicker-value",m),"select"==l?g.trigger("selectTime").trigger("changeTime").trigger("change","timepicker"):-1==["error","initial"].indexOf(l)&&g.trigger("changeTime"),!0):(g.trigger("selectTime"),!1)}function w(g){switch(g.keyCode){case 13:case 9:break;default:g.preventDefault()}}function z(g){var m=c(this),l=m.data("timepicker-list");if(!l||!a(l)){if(40!=g.keyCode)return!0;F.show.call(m.get(0));l=m.data("timepicker-list");k(m)||m.focus()}switch(g.keyCode){case 13:return B(m)&&(n.call(m.get(0),
{type:"change"}),F.hide.apply(this)),g.preventDefault(),!1;case 38:var r=l.find(".ui-timepicker-selected");return r.length?r.is(":first-child")||(r.removeClass("ui-timepicker-selected"),r.prev().addClass("ui-timepicker-selected"),r.prev().position().top<r.outerHeight()&&l.scrollTop(l.scrollTop()-r.outerHeight())):(l.find("li").each(function(v,A){return 0<c(A).position().top?(r=c(A),!1):void 0}),r.addClass("ui-timepicker-selected")),!1;case 40:return r=l.find(".ui-timepicker-selected"),0===r.length?
(l.find("li").each(function(v,A){return 0<c(A).position().top?(r=c(A),!1):void 0}),r.addClass("ui-timepicker-selected")):r.is(":last-child")||(r.removeClass("ui-timepicker-selected"),r.next().addClass("ui-timepicker-selected"),r.next().position().top+2*r.outerHeight()>l.outerHeight()&&l.scrollTop(l.scrollTop()+r.outerHeight())),!1;case 27:l.find("li").removeClass("ui-timepicker-selected");F.hide();break;case 9:F.hide();break;default:return!0}}function E(g){var m=c(this),l=m.data("timepicker-list"),
r=m.data("timepicker-settings");if(!l||!a(l)||r.disableTextInput)return!0;switch(g.keyCode){case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 65:case 77:case 80:case 186:case 8:case 46:r.typeaheadHighlight?q(m,l):l.hide()}}function B(g){var m=g.data("timepicker-settings"),l=null,r=g.data("timepicker-list").find(".ui-timepicker-selected");return r.hasClass("ui-timepicker-disabled")?
!1:(r.length&&(l=r.data("time")),null!==l&&("string"!=typeof l&&(l=D(l,m)),u(g,l,"select")),!0)}function H(g,m){g=Math.abs(g);var l,r;g=Math.round(g/60);var v=[];return 60>g?v=[g,x.mins]:(l=Math.floor(g/60),r=g%60,30==m&&30==r&&(l+=x.decimal+5),v.push(l),v.push(1==l?x.hr:x.hrs),30!=m&&r&&(v.push(r),v.push(x.mins))),v.join(" ")}function D(g,m){if("number"!=typeof g)return null;var l=parseInt(g%60),r=parseInt(g/60%60),v=parseInt(g/3600%24);v=new Date(1970,0,2,v,r,l,0);if(isNaN(v.getTime()))return null;
if("function"===c.type(m.timeFormat))return m.timeFormat(v);for(var A="",G=0;G<m.timeFormat.length;G++)switch(l=m.timeFormat.charAt(G)){case "a":A+=11<v.getHours()?x.pm:x.am;break;case "A":A+=11<v.getHours()?x.PM:x.AM;break;case "g":l=v.getHours()%12;A+=0===l?"12":l;break;case "G":l=v.getHours();g===C&&(l=m.show2400?24:0);A+=l;break;case "h":l=v.getHours()%12;0!==l&&10>l&&(l="0"+l);A+=0===l?"12":l;break;case "H":l=v.getHours();g===C&&(l=m.show2400?24:0);A+=9<l?l:"0"+l;break;case "i":r=v.getMinutes();
A+=9<r?r:"0"+r;break;case "s":l=v.getSeconds();A+=9<l?l:"0"+l;break;case "\\":G++;A+=m.timeFormat.charAt(G);break;default:A+=l}return A}function y(g,m){if(""===g||null===g)return null;if("object"==typeof g)return 3600*g.getHours()+60*g.getMinutes()+g.getSeconds();if("string"!=typeof g)return g;g=g.toLowerCase().replace(/[\s\.]/g,"");"a"!=g.slice(-1)&&"p"!=g.slice(-1)||(g+="m");var l="("+x.am.replace(".","")+"|"+x.pm.replace(".","")+"|"+x.AM.replace(".","")+"|"+x.PM.replace(".","")+")?",r=g.match(new RegExp("^"+
l+"([0-9]?[0-9])\\W?([0-5][0-9])?\\W?([0-5][0-9])?"+l+"$"));if(!r)return null;g=parseInt(1*r[2],10);if(24<g){if(m&&!1===m.wrapHours)return null;g%=24}l=r[1]||r[5];var v=g;12>=g&&l&&(v=l==x.pm||l==x.PM,v=12==g?v?12:0:g+(v?12:0));r=3600*v+60*(1*r[3]||0)+(1*r[4]||0);12>g&&!l&&m&&m._twelveHourTime&&m.scrollDefault&&(m=r-m.scrollDefault(),0>m&&m>=C/-2&&(r=(r+C/2)%C));return r}var C=86400,x={am:"am",pm:"pm",AM:"AM",PM:"PM",decimal:".",mins:"mins",hr:"hr",hrs:"hrs"},F={init:function(g){return this.each(function(){var m=
c(this),l=[],r;for(r in c.fn.timepicker.defaults)m.data(r)&&(l[r]=m.data(r));l=c.extend({},c.fn.timepicker.defaults,l,g);if(l.lang&&(x=c.extend(x,l.lang)),l=b(l),m.data("timepicker-settings",l),m.addClass("ui-timepicker-input"),l.useSelect)d(m);else{if(m.prop("autocomplete","off"),l.showOn)for(var v in l.showOn)m.on(l.showOn[v]+".timepicker",F.show);m.on("change.timepicker",n);m.on("keydown.timepicker",z);m.on("keyup.timepicker",E);l.disableTextInput&&m.on("keydown.timepicker",w);n.call(m.get(0),
null,"initial")}})},show:function(g){var m=c(this),l=m.data("timepicker-settings");if(g&&g.preventDefault(),l.useSelect)return void m.data("timepicker-list").focus();k(m)&&m.blur();g=m.data("timepicker-list");if(!m.prop("readonly")&&(g&&0!==g.length&&"function"!=typeof l.durationTime||(d(m),g=m.data("timepicker-list")),!a(g))){m.data("ui-timepicker-value",m.val());q(m,g);F.hide();g.show();var r={};l.orientation.match(/r/)?r.left=m.offset().left+m.outerWidth()-g.outerWidth()+parseInt(g.css("marginLeft").replace("px",
""),10):r.left=m.offset().left+parseInt(g.css("marginLeft").replace("px",""),10);"t"==(l.orientation.match(/t/)?"t":l.orientation.match(/b/)?"b":m.offset().top+m.outerHeight(!0)+g.outerHeight()>c(window).height()+c(window).scrollTop()?"t":"b")?(g.addClass("ui-timepicker-positioned-top"),r.top=m.offset().top-g.outerHeight()+parseInt(g.css("marginTop").replace("px",""),10)):(g.removeClass("ui-timepicker-positioned-top"),r.top=m.offset().top+m.outerHeight()+parseInt(g.css("marginTop").replace("px",""),
10));g.offset(r);r=g.find(".ui-timepicker-selected");if(!r.length){var v=y(t(m));null!==v?r=p(m,g,v):l.scrollDefault&&(r=p(m,g,l.scrollDefault()))}r&&r.length?(r=g.scrollTop()+r.position().top-r.outerHeight(),g.scrollTop(r)):g.scrollTop(0);return l.stopScrollPropagation&&c(document).on("wheel.ui-timepicker",".ui-timepicker-wrapper",function(A){A.preventDefault();var G=c(this).scrollTop();c(this).scrollTop(G+A.originalEvent.deltaY)}),c(document).on("touchstart.ui-timepicker mousedown.ui-timepicker",
h),c(window).on("resize.ui-timepicker",h),l.closeOnWindowScroll&&c(document).on("scroll.ui-timepicker",h),m.trigger("showTimepicker"),this}},hide:function(g){g=c(this);var m=g.data("timepicker-settings");return m&&m.useSelect&&g.blur(),c(".ui-timepicker-wrapper").each(function(){var l=c(this);if(a(l)){var r=l.data("timepicker-input"),v=r.data("timepicker-settings");v&&v.selectOnBlur&&B(r);l.hide();r.trigger("hideTimepicker")}}),this},option:function(g,m){return"string"==typeof g&&"undefined"==typeof m?
c(this).data("timepicker-settings")[g]:this.each(function(){var l=c(this),r=l.data("timepicker-settings"),v=l.data("timepicker-list");"object"==typeof g?r=c.extend(r,g):"string"==typeof g&&(r[g]=m);r=b(r);l.data("timepicker-settings",r);v&&(v.remove(),l.data("timepicker-list",!1));r.useSelect&&d(l)})},getSecondsFromMidnight:function(){return y(t(this))},getTime:function(g){var m=t(this);if(!m)return null;m=y(m);if(null===m)return null;g||(g=new Date);g=new Date(g);return g.setHours(m/3600),g.setMinutes(m%
3600/60),g.setSeconds(m%60),g.setMilliseconds(0),g},isVisible:function(){var g=this.data("timepicker-list");return!(!g||!a(g))},setTime:function(g){var m=this.data("timepicker-settings"),l=m.forceRoundTime?f(y(g),m):D(y(g),m);return g&&null===l&&m.noneOption&&(l=g),u(this,l),this.data("timepicker-list")&&q(this,this.data("timepicker-list")),this},remove:function(){if(this.hasClass("ui-timepicker-input")){var g=this.data("timepicker-settings");return this.removeAttr("autocomplete","off"),this.removeClass("ui-timepicker-input"),
this.removeData("timepicker-settings"),this.off(".timepicker"),this.data("timepicker-list")&&this.data("timepicker-list").remove(),g.useSelect&&this.show(),this.removeData("timepicker-list"),this}}};c.fn.timepicker=function(g){return this.length?F[g]?this.hasClass("ui-timepicker-input")?F[g].apply(this,Array.prototype.slice.call(arguments,1)):this:"object"!=typeof g&&g?void c.error("Method "+g+" does not exist on jQuery.timepicker"):F.init.apply(this,arguments):this};c.fn.timepicker.defaults={appendTo:"body",
className:null,closeOnWindowScroll:!1,disableTextInput:!1,disableTimeRanges:[],disableTouchKeyboard:!1,durationTime:null,forceRoundTime:!1,maxTime:null,minTime:null,noneOption:!1,orientation:"l",roundingFunction:function(g,m){if(null===g)return null;if("number"!=typeof m.step)return g;var l=g%(60*m.step);return l>=30*m.step?g+=60*m.step-l:g-=l,g==C&&m.show2400?g:g%C},scrollDefault:null,selectOnBlur:!1,show2400:!1,showDuration:!1,showOn:["click","focus"],showOnFocus:!0,step:30,stopScrollPropagation:!1,
timeFormat:"g:ia",typeaheadHighlight:!0,useSelect:!1,wrapHours:!0}});(function(c){c.team={app_url:!1,content:!1,sidebar:!1,calendar:!1,title_pattern:"Team \u2014 %s",init:function(a){["is_debug","app_url","locales"].forEach(function(b){c.team[b]=a[b]});c(document).ajaxSend(function(b,d,e){e.crossDomain||"POST"!==(e.type||"").toUpperCase()||(b=(b=document.cookie.match(/(?:^|; )_csrf=([^;]*)/))?decodeURIComponent(b[1]):"",e.data=e.data||"","string"==typeof e.data?-1==e.data.indexOf("_csrf=")&&(e.data+=(0<e.data.length?"&":"")+"_csrf="+b,d.setRequestHeader("Content-type",
"application/x-www-form-urlencoded")):"object"==typeof e.data&&(e.data._csrf=b))});c.team.content=new ContentRouter({$content:c("#t-content")});c.team.setSync()},setTitle:function(a){if(a){var b=history.state;b&&(b.title=a);document.title=c.team.title_pattern.replace("%s",a)}},confirmContactDelete:function(a,b){c.post("?module=users&action=prepareDelete",{id:a},function(d){var e=new TeamDialog({html:d});if(b&&b.onInit)b.onInit();if(b&&b.onCancel)e.$wrapper.on("close",b.onCancel);if(b.onCancel||b.onDelete)e.$wrapper.on("contacts_deleted",
function(f,h){b&&b.onCancel&&e.$wrapper.off("close",b.onCancel);if(b&&b.onDelete)b.onDelete(h)})})},setSync:function(){function a(){c.post(c.team.app_url+"?module=calendarExternal&action=sync").always(function(){setTimeout(a,b)}).error(function(){return!1})}var b=3E4+Math.floor(100*Math.random())/100*3E4;setTimeout(a,c.team.is_debug?100:b/2)}}})(jQuery);
var ContentRouter=function(c){ContentRouter=function(a){this.$window=c(window);this.$content=a.$content;this.api_enabled=window.history&&window.history.pushState;this.xhr=!1;this.is_enabled=!0;this.initClass()};ContentRouter.prototype.initClass=function(){this.bindEvents()};ContentRouter.prototype.bindEvents=function(){var a=this,b=window.location.origin+c.team.app_url;c(document).on("click","a",function(d){var e=a.is_enabled&&this.href.substr(0,b.length)==b;d.ctrlKey||d.shiftKey||d.metaKey||!e||
(d.preventDefault(),a.load(this.href))});c("#wa-app-team").on("click","a",function(d){d.stopPropagation()});a.api_enabled&&(window.onpopstate=function(d){d.stopPropagation();a.onPopState(d)})};ContentRouter.prototype.load=function(a,b){var d=this;if(!(0<=a.indexOf(c.team.app_url)))return alert("Determine the path error"),!1;d.animate(!0);d.xhr&&d.xhr.abort();c(document).trigger("wa_before_load",{content_uri:a});d.xhr=c.get(a,function(e){!b&&d.api_enabled&&history.pushState({reload:!0,content_uri:a},
"",a);d.setContent(e);d.animate(!1);d.xhr=!1;c(document).trigger("wa_loaded")})};ContentRouter.prototype.reload=function(){var a=this.api_enabled&&history.state&&history.state.content_uri?history.state.content_uri:!1;a&&this.load(a,!0)};ContentRouter.prototype.setContent=function(a){this.$content.html(a)};ContentRouter.prototype.onPopState=function(a){if(a=a.state||!1){if(!a.content_uri)return alert("Determine the path error"),!1;c(document).trigger("wa_before_load",{content_uri:a.content_uri});a.reload?
this.reload(a.content_uri):a.content&&this.setContent(a.content);a.title&&c.team.setTitle(a.title);c.team.sidebar.selectLink(a.content_uri);c(document).trigger("wa_loaded")}else location.reload()};ContentRouter.prototype.animate=function(a){var b=this.$content;c(".router-loading-indicator").remove();a&&(a=b.find(".t-content-header h1"),a.length&&a.append('<i class="icon16 loading router-loading-indicator"></i>'))};return ContentRouter}(jQuery),TeamDialog=function(c){TeamDialog=function(a){this.$wrapper=
c(a.html);this.$block=!1;if(this.is_full_screen=this.$wrapper.hasClass("is-full-screen"))this.$block=this.$wrapper.find(".t-dialog-block");this.position=a.position||!1;this.is_closed=!1;this.userPosition=a.setPosition||!1;this.onBgClick=a.onBgClick||!1;this.onOpen=a.onOpen||function(){};this.onClose=a.onClose||function(){};this.onRefresh=a.onRefresh||!1;this.onResize=a.onResize||!1;this.initClass()};TeamDialog.prototype.initClass=function(){this.$wrapper.data("teamDialog",this);this.show();this.bindEvents()};
TeamDialog.prototype.bindEvents=function(){var a=this,b=c(document),d=a.$block?a.$block:a.$wrapper;setTimeout(function(){function e(){a.is_closed||a.close();b.off("click",e);b.off("wa_before_load",e)}function f(){c.contains(document,a.$wrapper[0])?a.resize():c(window).off("resize",f)}b.on("click",e);b.on("wa_before_load",e);a.$wrapper.on("close",e);if(a.is_full_screen)a.$wrapper.on("click",".t-dialog-background",function(h){if(a.onBgClick)a.onBgClick(h);else h.stopPropagation()});d.on("click",function(h){h.stopPropagation()});
c(document).on("keyup",function(h){27===h.keyCode&&a.close()});d.on("click",".js-close-dialog",function(){e()});if(a.is_full_screen)c(window).on("resize",f)},0)};TeamDialog.prototype.show=function(){c("body").append(this.$wrapper);this.setPosition();this.onOpen(this.$wrapper,this)};TeamDialog.prototype.setPosition=function(){function a(p){return{left:parseInt((d-p.width)/2),top:parseInt((e-p.height)/2)}}var b=c(window),d=b.width(),e=this.is_full_screen?b.height():c(document).height();b=this.$block?
this.$block:this.$wrapper;var f=b.outerWidth(),h=b.outerHeight();var k=this.position?this.position:(this.userPosition?this.userPosition:a)({width:f,height:h});0<k.left&&k.left+f>d&&(k.left=d-f-10);0<k.top?k.top+h>e&&(k.top=e-h-10):(k.top=10,this.is_full_screen&&(f=b.find(".t-dialog-content"),f.hide(),h=b.outerHeight(),f.height(e-h-20).addClass("is-long-content").show()));b.css(k)};TeamDialog.prototype.close=function(){this.is_closed=!0;this.$wrapper.remove();this.onClose(this.$wrapper,this)};TeamDialog.prototype.refresh=
function(){this.onRefresh&&(this.onRefresh(),this.close())};TeamDialog.prototype.resize=function(){this.$block.addClass("is-animated");this.setPosition();if(this.onResize)this.onResize(this.$wrapper,this)};return TeamDialog}(jQuery),TeamEditable=function(c){TeamEditable=function(a){this.$wrapper=a.$wrapper;this.save=a.onSave||function(){};this.render=a.onRender||!1;this.text=(this.is_empty=this.$wrapper.hasClass("is-empty"))?"":this.$wrapper.text();this.is_edit=this.$field=!1;this.initClass()};TeamEditable.prototype.initClass=
function(){this.$field=this.renderField();this.bindEvents()};TeamEditable.prototype.bindEvents=function(){var a=this;a.$wrapper.on("click",function(){a.toggle()});a.$field.on("blur",function(){a.save(a)});a.$field.on("keyup",function(b){var d=27===b.keyCode;13===b.keyCode?a.save(a):d&&(a.$field.val(a.text),a.toggle("hide"))})};TeamEditable.prototype.renderField=function(){var a=this.$wrapper.text(),b=c('<input class="bold" type="text" name="" />');this.is_empty||b.val(a);var d=this.$wrapper.parent().width();
a=this.$wrapper.width();d=600<d?600:d-50;b.width(a>d?a:d).hide();this.$wrapper.after(b);this.render&&this.render(this,b);return b};TeamEditable.prototype.toggle=function(a){(a="hide"!==a)?(this.$wrapper.hide(),this.$field.show().focus()):(this.$wrapper.show(),this.$field.hide());this.is_edit=a};return TeamEditable}($);var Sidebar=function(c){var a=function(){a=function(b){this.$window=c(window);this.$wrapper=b.$wrapper;this.$block=b.$block;this.$content=b.$content;this.top_fix_class="fixed-to-top";this.bottom_fix_class="fixed-to-bottom";this.debug=!0};a.prototype.log=function(b){this.debug&&console.log(b)};a.prototype.initClass=function(){function b(){if(c.contains(document,w[0])){var m=Math.floor(p.$content.outerHeight()),l=Math.floor(w.outerHeight()),r=Math.floor(u.height()),v=t.scrollTop(),A=Math.floor(w.offset().top),
G=F>v?1:-1,K=v-B;g=w.width();if(!(!H&&r>E&&760<=z)||m&&m<l)H?(A=Math.floor(u.height()),G=Math.floor(u.offset().top),G=A+G-E-v,K=l-E,H=!1,A>l&&v>B&&(K<G?f(0):h())):k();else{m=E>l+0;r=v<=B;var I=parseInt(A+l-v-E);l=0<I;I=0>=I;if(m)0<K+0?(D||y||!C)&&f(0):(D||C||y||x)&&k();else if(r){if(D||y||C)x?A<=B&&k():k()}else l?0<G?A>=0+v&&(D||!C||y)&&f():(!D||C||y)&&e(A-B):I?0<G?(!D||C||y)&&e(A-B):(D||C||!y)&&h():(!D||C||y)&&e(A-B)}F=v}else t.off("scroll",b)}function d(){c.contains(document,w[0])?(z=Math.floor(t.width()),
E=Math.floor(t.height()),k(),t.trigger("scroll")):t.off("scroll",d)}function e(m){p.log("Manual top scroll position");w.css("top",m).width(g).removeClass(q).removeClass(n);D=!0;C=y=x=!1}function f(m){p.log("Fixed to top scroll position");w.removeAttr("style").width(g).removeClass(n).addClass(q);m&&(x=!0,w.css("top",m));D=y=!1;C=!0}function h(){p.log("Fixed to bottom scroll position");w.removeAttr("style").width(g).removeClass(q).addClass(n);D=C=x=!1;y=!0}function k(){p.log("Default scroll position");
w.removeAttr("style").removeClass(n).removeClass(q);D=C=y=x=!1}var p=this,q=p.top_fix_class,n=p.bottom_fix_class,t=p.$window,u=p.$wrapper,w=p.$block,z=Math.floor(t.width()),E=Math.floor(t.height()),B=w.offset().top,H=!0,D=!1,y=!1,C=!1,x=!1,F=0,g;t.on("scroll",b).on("resize",d)};return a}();Sidebar=function(b){this.$wrapper=b.$wrapper;this.$groupsWrapper=this.$wrapper.find(".t-groups-list");this.$groups=this.$groupsWrapper.find("> li");this.$locationsWrapper=this.$wrapper.find(".t-locations-list");
this.$locations=this.$locationsWrapper.find("> li");this.$searchForm=this.$wrapper.find(".t-search-form");this.app_url=b.app_url;this.selected_class="selected";this.storage_count_name="team/sidebar_counts";this.can_sort=b.can_sort;this.link_count_update_date=!1;this.$activeMenuItem=this.$wrapper.find("li."+this.selected_class+":first")||!1;this.counters={};this.xhr=this.is_locked=this.storageCount=!1;this.timer=0;this.initClass()};Sidebar.prototype.initClass=function(){this.bindEvents();this.setCounts();
this.initElasticBlock();this.initUpdater();this.can_sort&&this.initSortable();this.initDroppable();this.$activeMenuItem.length||this.selectLink()};Sidebar.prototype.bindEvents=function(){var b=this;b.$wrapper.on("click","li > a",function(d){b.onLinkClick(c(this))});b.$wrapper.on("click",".js-add-user-group",function(d){d.preventDefault();b.showGroupDialog()});b.$wrapper.on("click",".js-add-user-location",function(d){d.preventDefault();b.showGroupDialog(!0)});b.$searchForm.on("submit",function(d){d.preventDefault();
(d=c.trim(b.$searchForm.find(".t-search-field").val()))&&b.showSearch(d)});c("#t-new-user-link").on("click",function(d){d.preventDefault();d.stopPropagation();b.showInviteDialog()})};Sidebar.prototype.onLinkClick=function(b){var d=b.attr("href");d&&"javascript:"!=d.substr(0,11)&&!b.hasClass("js-no-highlight")&&(this.setItem(b.closest("li")),c.team.setTitle(b.text()))};Sidebar.prototype.setItem=function(b){if(this.$activeMenuItem&&this.$activeMenuItem[0]==b[0])return!1;this.$activeMenuItem&&this.$activeMenuItem.removeClass(this.selected_class);
b.addClass(this.selected_class);this.$activeMenuItem=b};Sidebar.prototype.selectLink=function(b){if(b)var d=this.$wrapper.find('a[href="'+b+'"]:first');else if(!1===b)return this.$activeMenuItem&&(this.$activeMenuItem.removeClass(this.selected_class),this.$activeMenuItem=null),!1;if(d&&d.length)this.setItem(d.closest("li"));else{b=this.$wrapper.find("a[href^='"+this.app_url+"']");var e=location.pathname,f=0,h=0;b.each(function(k){var p=c(this).attr("href"),q=p.length;0<=e.indexOf(p)&&q>f&&(f=q,h=
k)});if(h||0===h)d=b.eq(h),this.setItem(d.closest("li"))}};Sidebar.prototype.reload=function(){var b=this,d=b.app_url+"?module=sidebar";clearTimeout(b.timer);b.xhr&&b.xhr.abort();b.xhr=c.get(d,{is_reload:1},function(e){b.xhr=!1;b.$wrapper.replaceWith(e)})};Sidebar.prototype.showInviteDialog=function(){var b=this;b.is_locked||(b.is_locked=!0,c.get(c.team.app_url+"?module=users&action=inviteform",function(d){b.is_locked=!1;new TeamDialog({html:d})}))};Sidebar.prototype.showGroupDialog=function(b){var d=
this,e=c.team.app_url+"?module=group&action=edit";b={type:b?"location":"group"};d.is_locked||(d.is_locked=!0,c.get(e,b,function(f){new TeamDialog({html:f});d.is_locked=!1}))};Sidebar.prototype.setCounts=function(){function b(k,p,q,n){if(0<=k.indexOf(e.app_url)){var t=e.$wrapper.find('a[href="'+k+'"]');if(t.length){q=p-q;var u=c('<strong class="small highlighted t-indicator '+(0<=q?"is-green":"is-red")+'">'+q+"</strong>");0<=q&&(t.append(u),t.one("click",function(w){w.preventDefault();u.remove();e.saveCount(k,
p);e.link_count_update_date=n;c(document).one("wa_loaded",function(){e.link_count_update_date=!1})}))}}}function d(){var k=new Date,p=parseInt(k.getUTCDate()),q=parseInt(k.getUTCMonth())+1,n=parseInt(k.getUTCFullYear()),t=parseInt(k.getUTCHours()),u=parseInt(k.getUTCMinutes());k=parseInt(k.getUTCSeconds());return result={year:n,month:q,day:p,hours:t,minutes:u,seconds:k}}var e=this,f=function(){var k={},p=e.$wrapper.find("li .js-count"),q=d();p.each(function(){var n=c(this),t=parseInt(n.text()),u=
n.closest("li").find("> a");0<=t&&(e.counters[u.attr("href")]=n,k[u.attr("href")]={count:t,date:q})});return k}(),h=function(k){var p={};(k=localStorage.getItem(k))&&(p=JSON.parse(k));return p}(e.storage_count_name);e.storageCount=c.extend(!0,{},f);h&&c.each(h,function(k,p){var q=k in f&&0<=f[k].count&&f[k].count!=p.count;0<=p.count&&q&&(e.storageCount[k].count=p.count,e.storageCount[k].date=p.date,b(k,f[k].count,p.count,p.date))});e.setStorage()};Sidebar.prototype.saveCount=function(b,d){b in this.storageCount&&
(this.storageCount[b].count=d);this.setStorage()};Sidebar.prototype.updateCount=function(b,d){if(!b||!d&&0!==d)return!1;var e=this.counters[b]||!1;this.saveCount(b,d);e.length?e.text(d):this.reload()};Sidebar.prototype.setStorage=function(){localStorage.setItem(this.storage_count_name,JSON.stringify(this.storageCount))};Sidebar.prototype.initElasticBlock=function(){var b=this;c(document).ready(function(){new a({$wrapper:c("#wa-app"),$block:b.$wrapper,$content:c("#t-content")});var d=c(window);0<d.scrollTop()&&
d.trigger("scroll")})};Sidebar.prototype.initUpdater=function(){var b=this;b.timer=setTimeout(function(){c.contains(document,b.$wrapper[0])&&b.reload()},3E5)};Sidebar.prototype.initSortable=function(){function b(n){var t=[];n.find("> li").each(function(){var u=c(this).data("group-id");u&&0<u&&t.push(u)});return t}function d(n,t){q&&(q.abort(),q=!1);q=c.post(n,t,function(){q=!1})}var e=this.$groupsWrapper,f=this.$locationsWrapper,h=this.$locations,k=this.app_url+"?module=group&action=sortSave",p,q=
!1;1<this.$groups.length&&e.sortable({items:"> li",axis:"y",delay:200,tolerance:"pointer",start:function(n,t){p=t.item.index()},stop:function(n,t){t.item.removeAttr("style");if(p!=t.item.index()){n=b(e);var u=[];c.each(n,function(w,z){u.push({name:"groups[]",value:z})});d(k,u)}}});1<h.length&&f.sortable({items:"> li",axis:"y",delay:200,tolerance:"pointer",start:function(n,t){p=t.item.index()},stop:function(n,t){t.item.removeAttr("style");p!=t.item.index()&&(n=b(f),d(k,{locations:n}))}})};Sidebar.prototype.initDroppable=
function(){function b(e,f){e=parseInt(e.data("group-id"));var h=parseInt(f.data("user-id"));f=c.team.app_url+"?module=group&action=userAdd";if(!(0<e&&0<h))return!1;e={user_id:h,group_id:e};d&&d.abort();d=c.post(f,e,function(k){"ok"==k.status&&c.team.sidebar.reload();d=!1})}var d=!1;this.$groups.each(function(){var e=c(this);e.hasClass("js-drop-place")&&e.droppable({tolerance:"pointer",hoverClass:"is-hovered",over:function(f,h){h.draggable.hasClass("ui-draggable")||e.removeClass("is-hovered")},drop:function(f,
h){b(c(this),h.draggable)}})});this.$locations.each(function(){var e=c(this);e.hasClass("js-drop-place")&&e.droppable({tolerance:"pointer",hoverClass:"is-hovered",over:function(f,h){h.draggable.hasClass("ui-draggable")||e.removeClass("is-hovered")},drop:function(f,h){b(c(this),h.draggable)}})})};Sidebar.prototype.showSearch=function(b){b=encodeURIComponent(b);c.team.content.load(this.app_url+"search/"+b+"/")};return Sidebar}(jQuery);var CalendarPage=function(c){var a=function(b){a=function(d){this.$wrapper=d.$wrapper;this.$monthSelect=this.$wrapper.find(".month");this.$yearSelect=this.$wrapper.find(".year");this.filters_href=d.filters_href;this.month=parseInt(this.$monthSelect.val());this.year=parseInt(this.$yearSelect.val());this.initClass()};a.prototype.initClass=function(){var d=this;d.$monthSelect.on("change",function(){var e=b(this).val();e&&(d.month=parseInt(e));d.useFilter();return!1});d.$yearSelect.on("change",function(){var e=
b(this).val();e&&(d.year=parseInt(e));d.useFilter();return!1});d.$wrapper.on("click",".t-arrow",function(){var e=b(this);e.hasClass("left")&&d.changeMonth(!1);e.hasClass("right")&&d.changeMonth(!0);d.useFilter();return!1})};a.prototype.changeMonth=function(d){d?12<=this.month?(this.month=1,this.year++):this.month++:1>=this.month?(this.month=12,this.year--):this.month--};a.prototype.useFilter=function(){var d="start="+(this.year+"-"+(9<this.month?this.month:"0"+this.month)+"-01"),e=this.filters_href.split("?"),
f=e[0];e=e[1]||"";e=0<=e.indexOf("&")?e.split("&"):[e];var h=!1;e.length&&b.each(e,function(k,p){"start"==p.split("=")[0]&&(h=k)});h||0===h?e[h]=d:e.push(d);d=f+"?"+e.join("&");b.team.content.load(d)};return a}(jQuery);CalendarPage=function(b){this.$wrapper=b.$wrapper;this.$dateFilter=b.$dateFilter;this.filters_href=b.filters_href;this.user_id=b.user_id;this.local_storage=new c.store;this.initClass()};CalendarPage.prototype.initClass=function(){new a({$wrapper:this.$dateFilter,filters_href:this.filters_href});
this.initInfoBlock()};CalendarPage.prototype.initInfoBlock=function(){var b=this.$wrapper.find(".t-info-notice-wrapper"),d=this.local_storage;d.get("team/calendar_info_warn_block_hide")?b.hide():b.show();b.find(".t-info-notice-toggle").on("click",function(){d.set("team/calendar_info_warn_block_hide",1);b.hide()})};return CalendarPage}(jQuery),TeamCalendar=function(c){function a(b){var d=[];b.each(function(){var e=[];c(this).find(".t-day-ornament").each(function(){e.push(c(this))});d.push(e)});return d}
TeamCalendar=function(b){this.$wrapper=b.$wrapper;this.$rows=this.$wrapper.find(".t-week-row");this.days_count=7;this.weeks_count=this.$rows.length;this.selected_class="is-selected";this.active_class="is-active";this.locales=b.locales;this.is_profile=b.is_profile;this.event_view_uri="?module=schedule&action=eventView";this.event_edit_uri="?module=schedule&action=eventEdit";this.day_uri="?module=schedule&action=day";this.user_id=b.user_id;this.has_right_to_change=b.has_right_to_change;this.selected_user_id=
b.selected_user_id;this.selected_calendar_id=b.selected_calendar_id;this.period_start=b.period_start;this.period_end=b.period_end;this.daysArray=a(this.$rows);this.wrapper_o=this.$wrapper.offset();this.wrapper_w=this.$wrapper.width();this.wrapper_h=this.$wrapper.height();this.day_h=this.day_w=0;this.dialogs=[];this.end=this.start=this.xhr=!1;this.$selectedDays=[];this.is_locked=!1;this.bindEvents();this.initHoverOnDay();this.initMove()};TeamCalendar.prototype.bindEvents=function(){function b(k){c.contains(document,
f.$wrapper[0])?27===k.keyCode&&f.deselectDays():c(document).off("keydown",b)}function d(k){f.is_locked||(f.is_locked=!0,f.onMouseMove(k),setTimeout(function(){f.is_locked=!1},10));return!1}function e(){f.onMouseUp();f.$wrapper.off("mousemove",d);h.off("mouseup",e);return!1}var f=this,h=c(document);f.has_right_to_change&&(f.$wrapper.find(".show-full-days-events, .t-event-wrapper").on("mousedown",function(k){k.stopPropagation();f.clearSelection()}),h.on("mousedown",function(){f.clearSelection()}),f.$wrapper.on("mousedown",
function(k){k.stopPropagation();f.closeDialogs()||(f.onMouseDown(k),f.$wrapper.on("mousemove",d),h.on("mouseup",e));return!1}));f.$wrapper.on("click",".show-full-days-events",function(k){k.preventDefault();f.closeDialogs()||f.showFullDayEvents(c(this))});f.$wrapper.on("click",".t-event-block.js-view-event",function(k){k.preventDefault();f.closeDialogs()||f.showEventDetails(c(this).closest(".t-event-wrapper"))});c(document).on("keydown",b)};TeamCalendar.prototype.showFullDayEvents=function(b){var d=
this,e=b.data("events-id").split(",");e={date:b.data("date"),id:e};d.xhr&&(d.xhr.abort(),d.xhr=!1);d.xhr=c.post(d.day_uri,e,function(f){var h=b.closest(".t-action-wrapper"),k=h.closest(".t-week-row"),p=k.offset().top,q=h.offset().left,n=h.outerWidth(),t=k.outerHeight();f=c.waDialog({html:f,animate:!1,position:function(u){var w=u.width,z=(w-n)/2;u=(u.height-t)/2;u=p-(0<u?u:0);z=q-(0<z?z:0);w=c(window).width()-(z+w);0>w&&(z-=Math.abs(w)+10);return{top:u,left:z}},onBgClick:function(u,w,z){z.close()}});
d.addDialog(f)})};TeamCalendar.prototype.showEventDetails=function(b){var d=this;b={"data[id]":b.data("id")};d.xhr&&(d.xhr.abort(),d.xhr=!1);d.xhr=c.post(d.event_view_uri,b,function(e){e=c.waDialog({html:e});d.addDialog(e)})};TeamCalendar.prototype.createEvent=function(){var b=this,d=b.daysArray[b.end.week-1][b.end.day-1],e=b.daysArray[b.start.week-1][b.start.day-1].data("date");d=d.data("date");var f={"data[start]":!1,"data[end]":!1,"data[contact_id]":b.selected_user_id||b.user_id},h=(new Date).getHours();
f["data[start]"]=e.replace("00:00:00",23<=h?"23:59:59":h+1+":00:00");f["data[end]"]=d.replace("00:00:00",22<=h?"23:59:59":h+2+":00:00");b.selected_calendar_id&&(f["data[calendar_id]"]=b.selected_calendar_id);b.xhr&&(b.xhr.abort(),b.xhr=!1);b.xhr=c.post(b.event_edit_uri,f,function(k){k=c.waDialog({html:k});b.addDialog(k)})};TeamCalendar.prototype.onMouseDown=function(b){this.end=this.start=this.getDayPosition(b);this.markDays()};TeamCalendar.prototype.onMouseMove=function(b){b=this.getDayPosition(b);
this.end&&this.end.week==b.week&&this.end.day==b.day||(this.end=b,this.markDays())};TeamCalendar.prototype.initHoverOnDay=function(b){function d(){f&&f.removeClass("is-highlighted");f=!1}var e=this,f=!1;e.$wrapper.on("mousemove",function(h){var k=e.getDayPosition(h),p=e.daysArray,q=!1;p[k.week-1]&&p[k.week-1][k.day-1]&&(q=p[k.week-1][k.day-1]);k=q;h=c(h.target);if(h.hasClass("t-event-block")||h.closest(".t-event-block").length||e.start||!k)return d(),!1;if(k.hasClass("is-highlighted"))return!1;f&&
d();k.addClass("is-highlighted");f=k}).on("mouseleave",function(){d()})};TeamCalendar.prototype.onMouseUp=function(){if(this.start.week>this.end.week||this.start.week==this.end.week&&this.start.day>this.end.day){var b={week:this.start.week,day:this.start.day};this.start={week:this.end.week,day:this.end.day};this.end=b}this.createEvent();this.end=this.start=!1};TeamCalendar.prototype.initMove=function(){function b(q){q=e.getDayPosition(q);var n=e.daysArray[q.week-1][q.day-1];if(!n)return console&&
console.log&&console.log("error: date is not exist"),!1;q=c.team.app_url+"?module=schedule&action=eventMove";n={id:parseInt(h.data("id")),start:n.data("date").replace(" 00:00:00","")};p&&p.abort();p=c.post(q,n,function(t){"ok"==t.status&&e.reload()},"json")}function d(q){var n=f.offset(),t=[n.left,n.left+f.outerWidth()];n=[n.top,n.top+f.outerHeight()];e.clearSelection();if(q.pageX<=t[0]||q.pageX>=t[1]||q.pageY<=n[0]||q.pageY>=n[1])return!1;t=parseInt(h.data("day-count")||h.closest(".t-column").attr("colspan"));
e.start=e.getDayPosition(q);q=e.daysArray;var u=e.start;n={week:u.week,day:u.day};u=7-u.day;--t;t<=u?n.day+=t:(n.week+=1,n.day=t-u,n.week>q.length&&(n={week:q.length,day:7}));e.end=n;e.markDays()}var e=this,f=e.$wrapper,h=!1,k=!1,p;f.find(".js-move-event").draggable({helper:"clone",appendTo:"body",cursor:"move",delay:200,cursorAt:{top:11,left:16},start:function(q,n){q=c(n.helper.context);n=n.helper;h=q;var t=parseInt(h.closest(".t-column").attr("colspan")),u=q.data("move-hint")||!1;u&&n.find(".t-event-block").append("<span class='t-day-count'>("+
u+")</span>");n.addClass("is-clone").css({minWidth:parseInt(q.width()/t)+"px",height:q.height()+"px"})},drag:function(q,n){k||(k=!0,setTimeout(function(){k=!1},100),d(q))},stop:function(q,n){e.clearSelection();h=!1}});f.droppable({drop:function(q){b(q)}})};TeamCalendar.prototype.markDays=function(){this.deselectDays();var b=c.extend({},this.start),d=c.extend({},this.end);b.week>d.week&&(b=c.extend({},this.end),d=c.extend({},this.start));for(var e=b.week,f=d.week,h=e;h<=f;h++){if(e==f){var k=b.day;
var p=d.day;k>p&&(k=d.day,p=b.day)}else h==e?(k=b.day,p=this.days_count):h==f?(k=1,p=d.day):(k=1,p=this.days_count);for(;k<=p;k++)if(0<h&&0<k){var q=this.daysArray[h-1][k-1];q.length?(q.addClass(this.selected_class),this.$selectedDays.push(q)):console.log("Error: Day isn't exist")}}};TeamCalendar.prototype.getDayPosition=function(b){this.wrapper_o=this.$wrapper.offset();this.wrapper_w=this.$wrapper.width();this.wrapper_h=this.$wrapper.height();this.day_w=this.wrapper_w/this.days_count;this.day_h=
this.wrapper_h/this.weeks_count;var d=b.pageY-this.wrapper_o.top;b=b.pageX-this.wrapper_o.left;d=parseInt(d/this.day_h)+(0<d%this.day_h?1:0);b=parseInt(b/this.day_w)+(0<b%this.day_w?1:0);return{week:d,day:b}};TeamCalendar.prototype.deselectDays=function(){var b=this;b.$selectedDays.length&&(c.each(b.$selectedDays,function(){c(this).removeClass(b.selected_class)}),b.$selectedDays=[])};TeamCalendar.prototype.clearSelection=function(){this.deselectDays();this.end=this.start=!1};TeamCalendar.prototype.reload=
function(){var b=this,d={};b.closeDialogs();b.selected_user_id&&(d.user=b.selected_user_id);b.selected_calendar_id&&(d.calendar=b.selected_calendar_id);b.period_start&&(d.start=b.period_start);b.period_end&&(d.end=b.period_end);b.is_profile&&(d.period=1);c.get("?module=schedule&action=inc",d,function(e){c.team.calendar=!1;b.$wrapper.closest(".t-calendar-wrapper").replaceWith(e)})};TeamCalendar.prototype.addDialog=function(b){this.dialogs.push(b)};TeamCalendar.prototype.closeDialogs=function(){var b=
!1;this.dialogs.length&&(c.each(this.dialogs,function(d,e){c.contains(document,e.$wrapper[0])&&(e.close(),b=!0)}),this.dialogs=[]);c("#ui-datepicker-div").length&&c(document).trigger("mousedown");return b};return TeamCalendar}(jQuery),DayEventsDialog=function(c){DayEventsDialog=function(a){this.$wrapper=a.$wrapper;this.event_view_uri="?module=schedule&action=eventView";this.xhr=this.dialog=!1;this.initClass()};DayEventsDialog.prototype.initClass=function(){var a=this;a.$wrapper.on("click",".t-event-block.js-view-event",
function(b){b.preventDefault();a.showEventDetails(c(this).closest(".t-event-wrapper"))})};DayEventsDialog.prototype.showEventDetails=function(a){var b=this;a={"data[id]":a.data("id")};b.xhr&&(b.xhr.abort(),b.xhr=!1);b.xhr=c.post(b.event_view_uri,a,function(d){b.dialog=c.waDialog({html:d})})};return DayEventsDialog}(jQuery),EventEditDialog=function(c){EventEditDialog=function(a){this.$wrapper=a.$wrapper;this.$form=this.$wrapper.find("form");this.$statusToggle=this.$wrapper.find(".t-status-toggle");
this.$calendarToggle=this.$wrapper.find(".js-calendar-dropdown");this.$typeToggle=this.$wrapper.find(".t-type-toggle");this.$userToggle=this.$wrapper.find(".js-user-dropdown");this.$startAltField=this.$wrapper.find("input[name='data[start_alt]']");this.$endAltField=this.$wrapper.find("input[name='data[end_alt]']");this.$summaryField=this.$form.find("input[name='data[summary]']");this.teamDialog=this.$wrapper.data("dialog");this.active_class="is-active";this.extended_class="is-extended";this.selected_class=
"selected";this.has_error_class="state-error";this.locales=a.locales;this.event_id=a.event_id;this.calendars=a.calendars;this.users=a.users;this.$activeStatusToggle=this.$statusToggle.find("."+this.active_class)||!1;this.is_status=a.is_status;this.is_changed=this.is_locked=!1;this.user_id=a.user_id;this.calendar_id=a.calendar_id;this.summary=a.summary;this.summary_type=a.summary_type;this.end_date_locale=this.start_date_locale=!1;this.initClass()};EventEditDialog.prototype.initClass=function(){this.initDatePicker();
this.initTimePicker();this.bindEvents();this.setStatusLocale();this.is_status&&this.generateStatusTypes()};EventEditDialog.prototype.bindEvents=function(){var a=this;a.$form.on("submit",function(b){b.preventDefault();a.is_locked||a.save(a.$form);return!1});a.$form.on("click",".js-delete-event",function(b){b.preventDefault();a.is_locked||a.showDeleteConfirm()});a.$statusToggle.on("click",".t-toggle-button",function(){a.changeStatus(c(this));a.changeColors();return!1});a.$calendarToggle.on("click",
".menu a",function(b){b.preventDefault();a.changeCalendar(c(this))});a.$startAltField.on("change",function(){a.setStatusLocale();a.generateStatusTypes()});a.$endAltField.on("change",function(){a.setStatusLocale();a.generateStatusTypes()});a.$summaryField.on("change",function(){a.summary=c(this).val();a.summary_type="custom"});a.$form.on("change","input[name='data[status_summary]']",function(){a.summary=c(this).val();a.$summaryField.val(a.summary)});a.$form.on("change",'textarea[name="data[description]"]',
function(){var b=c(this).val();a.$form.find('textarea[name="data[status_description]"]').val(b)});a.$form.on("change",'textarea[name="data[status_description]"]',function(){var b=c(this).val();a.$form.find('textarea[name="data[description]"]').val(b)});a.$form.on("summaryChange",function(){a.$summaryField.val(a.summary)});if(a.$userToggle.length)a.$userToggle.on("click",".menu a",function(b){b.preventDefault();a.changeUser(c(this))});a.$form.on("change",".js-extended-date",function(){a.dateToggle(c(this));
return!1});a.$form.find("input").on("mousedown",function(){var b=c(this);b.hasClass(a.has_error_class)&&b.removeClass(a.has_error_class).closest(".value").find(".state-error-hint").remove()})};EventEditDialog.prototype.initDatePicker=function(){this.$wrapper.find(".js-datepicker").each(function(){var a=c(this),b=a.closest(".t-date-wrapper").find("input[type='hidden']");a.datepicker({altField:b,altFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,shortYearCutoff:2,showOtherMonths:!0,selectOtherMonths:!0,
stepMonths:2,numberOfMonths:2,beforeShow:function(d,e){e.dpDiv.on("click",function(f){f.stopPropagation()});c(d).on("click",function(f){var h=!1,k=c("#ui-datepicker-div");k.length&&"none"!=k.css("display")&&(h=k);h&&(f.stopPropagation(),c(document).trigger("mousedown"),c(this).blur())})}})})};EventEditDialog.prototype.initTimePicker=function(){this.$wrapper.find(".js-timepicker").each(function(){var a=c(this),b=!1;a.timepicker();a.on("showTimepicker",function(){var d=a.data("timepicker-list");b||
(d.on("click",function(f){f.stopPropagation()}),b=!0);var e=parseInt(a.offset().top)+parseInt(a.outerHeight())-parseInt(c(window).scrollTop());d.css({position:"fixed",top:e})})})};EventEditDialog.prototype.showDeleteConfirm=function(){var a=this,b={id:a.event_id};a.is_locked=!0;a.xhr&&(a.xhr.abort(),a.xhr=!1);a.xhr=c.get("?module=schedule&action=eventDeleteConfirm",b,function(d){c.waDialog({html:d});a.is_locked=!1;a.close()})};EventEditDialog.prototype.changeColors=function(){var a=this.calendars[this.calendar_id],
b=a.bg_color,d=a.font_color,e=a.status_bg_color;a=a.status_font_color;this.$calendarToggle.find(".t-selected-item").css({"background-color":this.is_status?e:b,color:this.is_status?a:d})};EventEditDialog.prototype.changeStatus=function(a){if(!a.hasClass(this.active_class)){var b=a.data("status-id");this.$activeStatusToggle&&this.$activeStatusToggle.removeClass(this.active_class+" "+this.selected_class);a.addClass(this.active_class+" "+this.selected_class);this.$activeStatusToggle=a;this.$form.find('input[name="data[is_status]"]').val(b).trigger("change");
(this.is_status=a=1==b)?(this.$wrapper.removeClass("is-event").addClass("is-status"),a=this.$form.find(".js-extended-date"),a.prop("checked")||a.click()):this.$wrapper.removeClass("is-status").addClass("is-event");this.generateStatusTypes();this.teamDialog.resize()}};EventEditDialog.prototype.changeCalendar=function(a){var b=this,d=a.closest("li"),e=d.data("calendar-id");if(!d.hasClass(b.selected_class)&&!b.is_locked){b.is_locked=!0;var f=b.calendars[e];d=f.bg_color;var h=f.font_color,k=f.status_bg_color;
f=f.status_font_color;var p=a.text(),q=a.find("svg").data();a=q.prefix;q=q.icon;b.calendar_id=e;b.$calendarToggle.find("."+b.selected_class).removeClass(b.selected_class);b.$calendarToggle.find(".t-selected-item").css({"background-color":b.is_status?k:d,color:b.is_status?f:h}).html('<i class="'+a+" fa-"+q+'"></i><span class="custom-ml-8">'+p+"</span>");b.$form.find('input[name="data[calendar_id]"]').val(e).trigger("change");b.$calendarToggle.find(".menu");setTimeout(function(){b.is_locked=!1},500);
b.generateStatusTypes()}};EventEditDialog.prototype.changeUser=function(a){var b=this,d=a.closest("li"),e=d.data("user-id");if(!d.hasClass(b.selected_class)&&!b.is_locked){b.is_locked=!0;d=a.data("user-photo-url");a=a.text();b.user_id=e;b.$userToggle.find("."+b.selected_class).removeClass(b.selected_class);b.$userToggle.find(".t-selected-item").html('\n                <img src="'+d+'" class="userpic userpic20">\n                <span class="custom-ml-8">'+a+"</span>");b.$form.find('input[name="data[contact_id]"]').val(e).trigger("change");
var f=b.$userToggle.find(".menu");f.hide();setTimeout(function(){f.removeAttr("style");b.is_locked=!1},200)}};EventEditDialog.prototype.save=function(a){var b=this;a=function(d){function e(q){var n=q.split("-");q=parseInt(n[0]);var t=parseInt(n[1]);n=parseInt(n[2]);return 0<q&&0<t&&0<n?new Date(q,t-1,n):!1}function f(q){b.$form.find(".state-error-hint").remove();c.each(q,function(n,t){n=b.$form.find("[name='"+t.field+"']");n.length&&n.addClass(b.has_error_class).after('<span class="state-error-hint">'+
b.locales[t.locale]+"</span>")})}var h={},k=[];c.each(d,function(q,n){h[n.name]=n.value});h["data[summary_type]"]||(h["data[summary_type]"]="custom");if(d=b.is_status)h["data[description]"]=h["data[status_description]"]?h["data[status_description]"]:"",delete h["data[status_description]"],h["data[summary]"]=b.summary,delete h["data[status_summary]"];c.trim(h["data[summary]"]).length||(d?k.push({field:"data[status_summary]",locale:"empty"}):k.push({field:"data[summary]",locale:"empty"}));h["data[start]"].match(/^(\d){4}-(\d){2}-(\d){2}$/)||
k.push({field:"data[end]",locale:"date"});h["data[end]"].match(/^(\d){4}-(\d){2}-(\d){2}$/)||k.push({field:"data[end]",locale:"date"});d=e(h["data[start]"]);var p=e(h["data[end]"]);d>p&&(k.push({field:"data[start_alt]",locale:"period"}),k.push({field:"data[end_alt]",locale:"period"}));if(k.length)return f(k),!1;h["data[start_time]"].length||(h["data[start_time]"]="00:00");h["data[end_time]"].length||(h["data[end_time]"]="00:00");h["data[start]"]=h["data[start]"]+" "+h["data[start_time]"];h["data[end]"]=
h["data[end]"]+" "+h["data[end_time]"];h["data[is_allday]"]=h["data[is_allday]"]?1:0;delete h["data[start_time]"];delete h["data[end_time]"];delete h["data[start_alt]"];delete h["data[end_alt]"];return h}(a.serializeArray());b.is_locked=!0;a?c.post("?module=schedule&action=eventSave",a,function(d){if("ok"==d.status)d.data&&d.data.message&&alert(d.data.message),b.reloadCalendar();else if(d.errors){var e=null;c.each(d.errors,function(f,h){"redirect"===h[0]&&(e=h[1])});e&&(location.href=e)}b.close();
b.is_locked=!1},"json"):b.is_locked=!1};EventEditDialog.prototype.reloadCalendar=function(){c.team.calendar.reload()};EventEditDialog.prototype.dateToggle=function(a){console.log(a.prop("checked"));this.$form.find(".t-date-wrapper").toggleClass(this.extended_class,!a.prop("checked"))};EventEditDialog.prototype.generateStatusTypes=function(){var a=this,b=a.$typeToggle,d=function(){var e=b.find(".is-template li"),f=e.eq(0),h=e.eq(1);e=c("<ul></ul>");var k=a.calendars[a.calendar_id];if(k.default_status){var p=
f.clone();p.find(".t-type").text(k.default_status);p.find("input:radio").val("default");e.append(p)}p=f.clone();p.find(".t-type").text(k.name);p.find("input:radio").val("calendar");e.append(p);p=f.clone();p.find(".t-type").text((k.default_status?k.default_status:k.name)+" "+a.locales.till+" "+a.end_date_locale);p.find("input:radio").val("till");e.append(p);f=f.clone();f.find(".t-type").text((k.default_status?k.default_status:k.name)+" "+a.locales.from+" "+a.start_date_locale+" "+a.locales.till+" "+
a.end_date_locale);f.find("input:radio").val("interval");e.append(f);f=h.clone();f.find("input:radio").val("custom");a.summary&&f.find("input:text").val(a.summary);e.append(f);b.find(".value").html("").append(e);return e}();(function(e){e.on("change","input:radio",function(){var f=c(this),h=f.is(":checked"),k=f.closest("li").find(".t-type"),p=f.closest("li").find("input:text");if(h){if(k.length)a.summary=k.text();else if(p.length)a.summary=p.val();else return!1;a.summary_type=f.val();a.$form.trigger("summaryChange")}});
e.on("focus set","input:text",function(){var f=c(this),h=f.closest("li").find("input:radio");h.is(":checked")||h.prop("checked",!0).trigger("change");f.hasClass(a.has_error_class)&&f.removeClass(a.has_error_class).closest(".value").find(".state-error-hint").remove()});e.on("focus change keyup","input:text",function(){var f=c(this),h=f.val();a.summary=c("<div />").html(f.val()).text();h.length&&(a.summary_type="custom",a.summary=h)})})(d);(function(e){!a.summary_type&&a.summary&&(a.summary_type="custom");
if(a.summary_type){var f=e.find("input:radio[value='"+a.summary_type+"']");f.length?(f.click(),"custom"!==a.summary_type&&e.find("input:text").val("")):"default"==a.summary_type?e.find("input[value='calendar']").click():e.find("input:text").val(a.summary?a.summary:"").trigger("change")}else e.find("input:radio:first").click()})(d)};EventEditDialog.prototype.setStatusLocale=function(){function a(f){var h=f.val().split(" ")[0].split("-");f=parseInt(h[2]);var k=parseInt(h[1]);h=parseInt(h[0]);var p=
(new Date).getFullYear(),q=b.locales.status_type.months[k];f=c.datepicker.formatDate(b.locales.status_type.format,new Date(h,k-1,f));f=f.replace("f",q);p==h&&(f=f.replace(", "+h,"").replace(" "+h,"").replace(h+" ",""));return f}var b=this,d=b.$wrapper.find("input[name='data[start]']"),e=b.$wrapper.find("input[name='data[end]']");b.start_date_locale=a(d);b.end_date_locale=a(e)};EventEditDialog.prototype.close=function(){this.teamDialog.close()};return EventEditDialog}(jQuery),EventViewDialog=function(c){EventViewDialog=
function(a){this.$dialogWrapper=a.$wrapper;this.$wrapper=this.$dialogWrapper.find(".dialog-body");this.event_id=a.event_id;this.event_edit_uri="?module=schedule&action=eventEdit";this.xhr=!1;this.initClass()};EventViewDialog.prototype.initClass=function(){var a=this;a.$wrapper.on("click",".js-edit-event",function(b){b.preventDefault();a.showEditForm()})};EventViewDialog.prototype.showEditForm=function(){var a=this,b={"data[id]":a.event_id};a.xhr&&(a.xhr.abort(),a.xhr=!1);a.xhr=c.post(a.event_edit_uri,
b,function(d){a.$wrapper.offset();var e=c.team.calendar;a.close();d=c.waDialog({html:d});e.addDialog(d)})};EventViewDialog.prototype.close=function(){this.$dialogWrapper.data("dialog").close()};return EventViewDialog}(jQuery),EventDeleteDialog=function(c){EventDeleteDialog=function(a){this.$wrapper=a.$wrapper;this.$block=this.$wrapper.find(".dialog-body");this.event_id=a.event_id;this.is_locked=!1;this.initClass()};EventDeleteDialog.prototype.initClass=function(){var a=this;a.$block.on("click",".js-delete-event",
function(b){b.preventDefault();if(!a.is_locked)a["delete"]()})};EventDeleteDialog.prototype["delete"]=function(){var a=this,b={id:a.event_id};a.is_locked=!0;c.post("?module=schedule&action=eventDelete",b,function(d){"ok"==d.status&&(d.data&&d.data.message&&alert(d.data.message),a.$wrapper.data("dialog").close(),c.team.calendar.reload())})};return EventDeleteDialog}(jQuery);var Profile=function(c){Profile=function(a){this.$wrapper=a.$wrapper;this.$tabs=this.$wrapper.find(".t-profile-tabs");this.$tabContentPlace=this.$wrapper.find(".t-dynamic-content");this.$calendarPlace=this.$wrapper.find(".t-calendar-place");this.api_enabled=window.history&&window.history.pushState;this.user=a.user||{id:0};this.photo_dialog_url=a.photo_dialog_url;this.is_own_profile=a.is_own_profile||!1;this.wa_app_url=a.wa_app_url||"";this.backend_url=a.backend_url||"";this.wa_url=a.wa_url||"";this.wa_version=
a.wa_version||"";this.webasyst_id_auth_url=a.webasyst_id_auth_url||"";this.xhr=this.is_locked=!1;this.dialogs=[];this.initClass()};Profile.prototype.initClass=function(){this.initEditableJobtitle();this.bindEvents();c.team&&c.team.sidebar&&c.team.sidebar.selectLink(!1);new ProfileWebasystID({is_own_profile:this.is_own_profile,user:this.user,backend_url:this.backend_url,wa_url:this.wa_url,wa_version:this.wa_version,webasyst_id_auth_url:this.webasyst_id_auth_url})};Profile.prototype.bindEvents=function(){var a=
this;a.$tabs.on("click",".t-tab a",function(){a.changeTab(c(this));return!1});a.$calendarPlace.on("click",".js-calendar-toggle",function(e){e.preventDefault();a.calendarToggle(c(this))});a.$calendarPlace.on("click",".js-show-outer-calendar-manager",function(e){e.stopPropagation();a.showOuterDialogDialog()});a.$wrapper.on("photo_updated photo_deleted",function(e,f){a.$wrapper.find(".t-userpic").attr("src",f.url)});a.$wrapper.find(".js-change-photo").on("click",function(){var e=c("#contact-photo-crop-dialog");
e.length||(e=c('<div class="dialog" id="contact-photo-crop-dialog"/>'),c("body").append(e));e.load(a.photo_dialog_url,function(){c.waDialog({$wrapper:e})})});var b=a.$wrapper.find(".profile-header-links");b.on("click",".edit-link",function(){a.switchToTab("info",function(e){return"function"===typeof e[0].contentWindow.$.wa.contactEditor.switchMode}).then(function(e){e[0].contentWindow.$.wa.contactEditor.switchMode("edit")})});b.on("click",".delete-link",function(){var e=c(this).find("i");e.is(".loading")||
(e.toggleClass("delete loading"),c.team.confirmContactDelete([a.user.id],{onInit:function(){e.toggleClass("delete loading")},onDelete:function(){c.team.content.load(c.team.app_url)}}))});b=a.$wrapper.find(".t-profile-tabs-iframes");var d=c("#contact-info-top");b.on("contact_saved",function(e,f){e=d.closest(".t-profile-page").find(".profile .details h1").first();e.children(".contact-name:first").text(f.name);e.children(".title:first").text(f.title);e=e.closest(".details").find(".jobtitle-company");
e.children(".company").text(f.company);e.children(".title").text(f.jobtitle)});b.on("top_fields_updated",function(e,f){e="";for(var h=0;h<f.length;h++){var k=f[h];e+="<li>"+("im"!=k.id?k.icon?'<i class="icon16 '+k.id+'"></i>':"":"")+k.value+"</li>"}d.html(e)});c("#header-customize-groups-link").click(function(){a.switchToTab("access",function(e){return"function"===typeof e[0].contentWindow.ProfileAccessTab}).then(function(e){e[0].contentWindow.$("#form-customize-groups",e[0].contentWindow.body).is(":not(:visible)")&&
e[0].contentWindow.$("#open-customize-groups",e[0].contentWindow.body).click()})});a.$wrapper.find(".js-profile-user-slider").one("click",function(){c(this).animate({height:"375px"})});a.$wrapper.find(".js-userpic").one("click",function(){});a.$wrapper.find(".js-toggle-user-info").on("click",function(e){e.preventDefault();c(this).find("svg").toggleClass("fa-caret-down fa-caret-up");a.$wrapper.find(".js-user-info").toggleClass("hidden")})};Profile.prototype.switchToTab=function(a,b){function d(){var p=
e.children().filter(function(){return a==c(this).data("tab-id")}).first();try{p[0].contentWindow&&b(p)&&(setTimeout(function(){h.resolve(p)},0),f.off("tab_content_updated",d),k&&clearInterval(k),k=null)}catch(q){}}var e=this.$wrapper.find(".t-profile-tabs-iframes"),f=this.$wrapper.find('.t-tab a[data-tab-id="'+a+'"]'),h=c.Deferred();f.on("tab_content_updated",d);var k=setInterval(d,100);f.closest(".t-tab").hasClass("is-selected")?d():f.click();f.length&&c("html, body").animate({scrollTop:f.offset().top},
500);return h.promise()};Profile.prototype.changeTab=function(a){if(this.api_enabled){a=a.data("tab-id");var b=window.location.href.match(/^.*\/(id|u)\/[^\/]+/);b&&a&&(a=b[0]+"/"+a+"/",history.replaceState({reload:!0,content_uri:a},"",a))}};Profile.prototype.calendarToggle=function(a){var b=a.find(".t-calendar-toggle .text");this.$calendarPlace.hasClass("is-short")?(b.text(a.data("hide-text")),this.$calendarPlace.removeClass("is-short")):(b.text(a.data("show-text")),this.$calendarPlace.addClass("is-short"))};
Profile.prototype.showOuterDialogDialog=function(){function a(){c.post(d,e,function(f){new TeamDialog({html:f,onRefresh:a})}).always(function(){b.is_locked=!1})}var b=this,d="?module=schedule&action=settings",e={};0<b.user.id&&(d+="&id="+b.user.id);b.is_locked||(b.is_locked=!0,a())};Profile.prototype.initEditableJobtitle=function(){var a=this,b=a.$wrapper.find(".js-jobtitle-editable").first();b.length&&new TeamEditable({$wrapper:b,onSave:function(d){var e=d.$field.val(),f=!e.length;if(d.text!==e){var h=
c.team.app_url+"?module=profile&action=save",k={id:a.user.id,data:JSON.stringify({jobtitle:e})};d.$field.attr("disabled",!0);var p=c('<i class="icon16 loading"></i>').css("margin","0 0 0 4px").insertAfter(d.$field);c.post(h,k,function(){d.$field.attr("disabled",!1);p.remove();d.is_empty=f;d.text=e;d.$wrapper.text(e);d.toggle("hide");f&&d.$wrapper.parent().find(".at").hide()})}else d.toggle("hide")}})};return Profile}(jQuery),ActivityLazyLoading=function(c){ActivityLazyLoading=function(a){this.list_name=
a.names.list;this.items_name=a.names.items;this.pagind_name=a.names.paging;this.user_id=a.user_id;this.$wrapper=a.$wrapper||!1;this.$list=this.$wrapper.find(this.list_name);this.$window=c(window);this.onLoad=a.onLoad||function(){};this.$paging=this.$wrapper.find(this.pagind_name);this.is_locked=this.xhr=!1;this.addWatcher()};ActivityLazyLoading.prototype.addWatcher=function(){function a(){var e=window&&c.contains(document,b.$paging[0]);e&&d&&window.frameElement&&(e=c.contains(d.document,window.frameElement));
if(e)try{b.onScroll()}catch(f){e=!1}e||(b.$window.off("scroll",a),c(d).off("scroll",a))}var b=this,d=window.parent;b.$window.on("scroll",a);if(d&&window.frameElement)c(d).on("scroll",a)};ActivityLazyLoading.prototype.onScroll=function(){var a=this.$window,b=a.scrollTop();a=a.height();var d=this.$paging.offset().top;if(window.parent&&window.frameElement){var e=c(window.parent);a=e.height();b+=e.scrollTop();d+=c(window.frameElement).offset().top}b+a>=d&&!this.is_locked&&(this.is_locked=!0,this.loadNextPage())};
ActivityLazyLoading.prototype.loadNextPage=function(){var a=this,b=c.team.app_url+"?module=profile&action=activity",d={max_id:a.$paging.data("max-id"),id:a.user_id,timestamp:a.$list.find(a.items_name).last().data("timestamp")};a.xhr&&(a.xhr.abort(),a.xhr=!1);a.xhr=c.get(b,d,function(e){var f=c(e);e=f.find(a.list_name+" "+a.items_name);f=f.find(a.pagind_name);a.$list.append(e);a.$paging.after(f);a.$paging.remove();a.$paging=f;a.is_locked=!1;a.onLoad()})};return ActivityLazyLoading}(jQuery),OutsideCalendarsDialog=
function(c){OutsideCalendarsDialog=function(a){this.$dialogWrapper=a.$wrapper;this.$wrapper=this.$dialogWrapper.find(".t-dialog-block");this.$form=this.$wrapper.find("form");this.xhr=this.is_locked=!1;this.initClass()};OutsideCalendarsDialog.prototype.initClass=function(){this.bindEvents()};OutsideCalendarsDialog.prototype.bindEvents=function(){var a=this;a.$wrapper.on("click",".t-external-calendar-unmount",function(){a.deleteExternalCalendar(c(this).data("id"))});a.$wrapper.find(".js-add-external-calendar").on("click",
function(b){b.preventDefault();a.close();(b=c(this).attr("href"))&&c.team.content.load(b)})};OutsideCalendarsDialog.prototype.deleteExternalCalendar=function(a){c.get("?module=calendarExternal&action=DeleteConfirm",{id:a},function(b){new TeamDialog({html:b,onOpen:function(d){d.bind("afterDelete",function(){c.team.content.reload()})}})})};OutsideCalendarsDialog.prototype.close=function(){this.$wrapper.trigger("close")};return OutsideCalendarsDialog}(jQuery);var AccessPage=function(c){var a=function(d){a=function(e){this.$wrapper=e.$wrapper;this.$accessWrapper=this.$wrapper.find(".t-access-wrapper");this.$accessSlider=this.$wrapper.find(".t-access-slider");this.$headerApps=this.$wrapper.find(".t-header-apps");this.$headerList=this.$headerApps.find(".t-apps-list");this.$apps=this.$headerList.find(".t-app-item");this.item_count=this.$apps.length;this.type_class=!1;this.items_left=this.left=0;this.item_w=this.access_slider_w=this.access_wrapper_w=!1;this.initClass()};
a.prototype.initClass=function(){function e(){d.contains(document,f.$wrapper[0])?f.reset():d(window).off("resize",e)}var f=this;f.detectSliderWidth();f.showArrows();d(window).on("resize",e);f.$wrapper.on("click",".t-action",function(){var h=d(this);h.hasClass("left")&&f.moveSlider(!1);h.hasClass("right")&&f.moveSlider(!0)})};a.prototype.detectSliderWidth=function(){this.access_wrapper_w=this.$accessWrapper.outerWidth();this.access_slider_w=this.$accessSlider.outerWidth();this.item_w=this.$apps.first().outerWidth()};
a.prototype.showArrows=function(){function e(h){f.type_class&&(f.$accessWrapper.removeClass(f.type_class),f.$headerApps.removeClass(f.type_class));h&&(f.$accessWrapper.addClass(h),f.$headerApps.addClass(h),f.type_class=h)}var f=this;0<=f.left?f.access_wrapper_w<f.access_slider_w?e("type-1"):e():f.access_wrapper_w<f.access_slider_w-Math.abs(f.left)?e("type-2"):e("type-3")};a.prototype.setLeft=function(e){this.$headerList.css({left:e});this.$accessSlider.css({left:e});this.left=e};a.prototype.moveSlider=
function(e){var f=this.items_left;e?e=f+1:(e=f-1,0>e&&(e=0));f=e*this.item_w;f>-(this.access_wrapper_w-this.access_slider_w)&&(f=-(this.access_wrapper_w-this.access_slider_w));this.items_left=e;this.setLeft(-f);this.showArrows()};a.prototype.reset=function(){this.items_left=0;this.setLeft(0);this.detectSliderWidth();this.showArrows()};return a}(c),b=function(d){b=function(e){this.$wrapper=e.$wrapper;this.$header=this.$wrapper.find(".t-elastic-header");this.wrapper_offset=this.$wrapper.offset();this.header_w=
this.$header.outerWidth();this.header_h=this.$header.outerHeight();this.fixed_class="is-fixed";this.is_fixed=!1;this.initClass()};b.prototype.initClass=function(){function e(){if(d.contains(document,h.$header[0]))h.onScroll(k.scrollTop());else k.off("scroll",e)}function f(){if(d.contains(document,h.$header[0]))h.onResize();else k.off("resize",f)}var h=this,k=d(window);k.on("scroll",e).on("resize",f)};b.prototype.onScroll=function(e){e>this.wrapper_offset.top?(this.$header.addClass(this.fixed_class).css({left:this.wrapper_offset.left,
width:this.header_w}),this.is_fixed=!0):(this.$header.removeClass(this.fixed_class).removeAttr("style"),this.is_fixed=!1)};b.prototype.onResize=function(){this.header_w=this.$wrapper.outerWidth();this.is_fixed&&this.$header.width(this.header_w)};return b}(jQuery);AccessPage=function(d){this.$wrapper=d.$wrapper;this.slider=!1;this.dialogs=[];this.initClass()};AccessPage.prototype.initClass=function(){this.initAccessSlider();this.initElasticHeader();this.initHover();this.bindEvents()};AccessPage.prototype.bindEvents=
function(){var d=this;d.$wrapper.on("click",".t-access-status",function(f){f.preventDefault();f=c(this);f.hasClass("is-admin")&&!d.dialogs.length?c.team.content.load(f.data("uri")):showAccessDialog(f,f.data("app-id"),f.data("user-id"))});var e;c(document).on("team_access_level_changed",e=function(f,h){c.contains(document.body,d.$wrapper[0])?d.$wrapper.find('table.t-access-table tr[data-user-id="'+h.contact_id+'"] .t-access-status[data-app-id="'+h.app_id+'"]').removeClass("type-no type-limited type-full type-"+
h.prev_level).addClass("type-"+h.new_level):c(document).off("team_access_level_changed",e)})};AccessPage.prototype.initAccessSlider=function(){this.slider||(this.slider=new a({$wrapper:this.$wrapper}))};AccessPage.prototype.initElasticHeader=function(){new b({$wrapper:this.$wrapper})};AccessPage.prototype.closeDialogs=function(){var d=!1;this.dialogs.length&&(c.each(this.dialogs,function(e,f){c.contains(document,f.$wrapper[0])&&(f.close(),d=!0)}),this.dialogs=[]);return d};AccessPage.prototype.initHover=
function(){function d(){e&&(e.removeClass("highlighted"),e=!1);f&&(f.removeClass("highlighted"),f=!1)}var e=!1,f=!1;this.$wrapper.on("mouseenter",".t-access-status",function(){var h=c(this),k=h.data("user-id");h=h.data("app-id");d();k&&h&&(k=c("#t-user-"+k),h=c("#t-app-"+h),k.length&&(k.addClass("highlighted"),e=k),h.length&&(h.addClass("highlighted"),f=h))});this.$wrapper.on("mouseleave",".t-access-status",d)};return AccessPage}(jQuery);
(function(c){window.AccessDialog=function(a){function b(e){this.$dialogWrapper=e.$wrapper;this.$wrapper=this.$dialogWrapper.find(".t-dialog-block");this.$limitedContent=this.$wrapper.find(".t-limited-access-form");this.active_class="is-active";this.disabled_class="is-disabled";this.wa_app_url=e.wa_app_url;this.app_id=e.app_id;this.contact_id=e.contact_id;this.teamDialog=this.$dialogWrapper.data("teamDialog")||!1;this.noticeToggle=d(this.$wrapper);this.$activeTab=this.$wrapper.find(".t-access-item."+
this.active_class);this.active_access_id=this.$activeTab.data("access-id");this.is_locked=!1;this.initClass()}function d(e){var f=e.find(".t-loading"),h=e.find(".t-success"),k,p;return k={loading:function(){h.removeClass("is-visible");f.addClass("is-visible")},success:function(){h.addClass("is-visible");f.removeClass("is-visible");p&&clearTimeout(p);p=setTimeout(function(){a.contains(document,h[0])&&k.hide()},2E3)},hide:function(){p&&clearTimeout(p);f.removeClass("is-visible");h.removeClass("is-visible")}}}
b.prototype.initClass=function(){this.bindEvents()};b.prototype.bindEvents=function(){var e=this;e.$wrapper.on("click",".t-access-item",function(){var f=a(this),h=f.hasClass(e.active_class),k=f.hasClass(e.disabled_class);e.is_locked||h||k?k&&alert(f.data("reason-disabled")):(e.changeTab(f),e.teamDialog&&e.teamDialog.resize())});e.$wrapper.on("click",'input[type="submit"]',function(f){f.stopPropagation();e.save()})};b.prototype.changeTab=function(e){var f=e.data("access-id"),h=this.$limitedContent;
this.$activeTab.length&&this.$activeTab.removeClass(this.active_class);e.addClass(this.active_class);this.$activeTab=e;this.$wrapper.find(".t-hint").hide();"no"==f?this.$wrapper.find(".t-hint.js-access-no").show():"full"==f&&this.$wrapper.find(".t-hint.js-access-full").show();this.$limitedContent.length&&("limited"==f?h.show():h.hide())};b.prototype.save=function(){var e=this,f=e.$activeTab.data("access-id"),h=function(k){var p=!1,q={no:0,limited:1,full:2};q.hasOwnProperty(k)&&(p=q[k]);return p}(f);
e.is_locked=!0;e.noticeToggle.loading();h=a.post(e.wa_app_url+"?module=accessSave&action=rights&id="+e.contact_id,{app_id:e.app_id,name:"backend",value:h},"json");"limited"===f&&(h=h.then(function(){var k=e.$limitedContent.find("form");return a.post(k.attr("action"),k.serialize(),"json")}));h.then(function(){var k=e.active_access_id;a(document).trigger("team_access_level_changed",{app_id:e.app_id,contact_id:e.contact_id,prev_level:k,new_level:f});e.active_access_id=f;e.noticeToggle.success();e.is_locked=
!1;e.teamDialog.close()})};return b}(c);window.ProfileAccessTab=function(a){function b(){c(".js-webasyst-id-auth").on("click",function(n){n.preventDefault();window.top.$("body").trigger("wa_webasyst_id_auth")})}function d(n,t){if(c.fn.iButton){var u=c(".basic-user-fields"),w=c(".js-block-user-reason-form");w.on("click",".js-block-user-cancel",function(){w.hide()});w.on("submit",function(B){B.preventDefault();if(confirm(z.data("alert"))){B=w.find(".js-block-user-reason");B=c.trim(B.val());c(".c-shown-on-enabled").hide();
var H=E.parent().find(".loading").show();c.post(k+"?module=accessSave&action=ban&id="+h,{magic_word:"please",text:B},function(D){H.hide();w.hide();"ok"===D.status&&(u.addClass("gray"),c(".c-shown-on-disabled").show(),c("#tc-user-access-disabled").show().html(D.data.access_disable_msg))},"json")}});var z=c("#c-access-link-block").click(function(){w.show()}),E=c("#c-access-link-unblock").click(function(){if(!confirm(E.data("alert")))return!1;c(".c-shown-on-disabled").hide();var B=E.parent().find(".loading").show();
c.post(k+"?module=accessSave&action=unban&id="+h,{magic_word:"please"},function(){B.hide();u.removeClass("gray");c(".c-shown-on-enabled").show();c("#tc-user-access-disabled").hide().html("")})})}else c.ajax({cache:!0,dataType:"script",url:n+"wa-content/js/jquery-plugins/ibutton/jquery.ibutton.min.js?"+t,success:function(){d(n,t)}})}var e=a.login,f=a.password,h=a.contact_id,k=a.wa_app_url,p=a.url_change_api_token,q=a.loc;(function(){var n=c("#form-customize-groups");n.length&&(function(t){function u(w,
z){w=c(z||this);w.prop("checked")?w.parent().addClass("highlighted"):w.parent().removeClass("highlighted")}t.find('input[type="checkbox"]').click(u).each(u);return t}(c("#form-customize-groups .c-checkbox-menu")),c("#open-customize-groups").click(function(){c("#form-customize-groups").toggle()}),c("#cancel-customize-groups").click(function(){var t=c("#form-customize-groups").hide();t.find(".loading").hide();t.find(".errormsg").remove();return!1}),n.submit(function(){var t=c(this);t.find(".errormsg").remove();
t.find(".loading").show();c.post(t.attr("action"),t.serialize(),function(u){if("ok"==u.status){try{window.parent.$.team.sidebar.reload()}catch(w){}window.hasOwnProperty("profileTab")&&window.profileTab.reload()}else"fail"==u.status&&t.find(".c-checkbox-menu-container").after(c('<em class="errormsg">'+u.errors.join("<br />")+"</em>"))},"json");return!1}))})();(function(){c("#c-credentials-form").submit(function(){var n=c(this);n.find("input.error").removeClass("error");n.find(".errormsg").remove();
var t=n.find(".c-login-input"),u=c.trim(t.val());if(!u)return t.addClass("error").after('<em class="errormsg">'+q["Login is required"]+"</em>"),!1;t=n.serializeArray();"1"===c("#c-access-rights-toggle").val()&&(t=t.concat([{name:"set_rights",value:"1"},{name:"app_id",value:"webasyst"},{name:"name",value:"backend"},{name:"value",value:1}]));c.post(n.attr("action"),t,function(w){if("ok"===w.status){n.hide();e=u;c("#c-login-block").show().find(".c-login-input").val(e).end().find(".c-login").text(e);
try{window.parent.$.team.sidebar.reload()}catch(z){}try{window.profileTab.reload()}catch(z){}}else"fail"===w.status&&n.find('input[type="submit"]').parent().prepend(c('<em class="errormsg" style="margin-bottom:10px">'+w.errors.join("<br>")+"</em>"))},"json");return!1}).find(".cancel").click(function(){c("#c-credentials-block").hide();return!1})})();(function(){var n=c("#c-login-form"),t=n.find(".c-login-input");n.submit(function(){n.find("input.error").removeClass("error");n.find(".errormsg").remove();
var u=c.trim(t.val());if(e===u)return!1;if(!u)return t.addClass("error").after('<em class="errormsg">'+q["Login is required."]+"</em>"),!1;n.find(".loading").show();c.post(n.attr("action"),n.serialize(),function(w){n.find(".loading").hide();if("ok"===w.status){c("#c-login-block").show();t.val(u);n.find(".c-login").text(u);n.find(".c-one-tab").show();n.find(".c-two-tab").hide();if(!e)try{window.profileTab.reload()}catch(z){}e=u}else"fail"===w.status&&n.find('input[type="submit"]').parent().prepend(c('<em class="errormsg" style="margin-bottom:10px">'+
w.errors.join("\n<br>\n")+"</em>"))},"json");return!1});n.find(".c-tab-toggle").click(function(){n.find(".c-one-tab,.c-two-tab").toggle();t.is(":visible")&&t.focus();return!1})})();(function(){var n=c("#c-password-form"),t=n.find(".c-password-input"),u=n.find(".c-confirm-password-input");n.submit(function(){n.find("input.error").removeClass("error");n.find(".errormsg").remove();if(t.val()!==u.val())return t.addClass("error"),u.after().after('<em class="errormsg">'+q["Passwords do not match."]+"</em>"),
!1;n.find(".loading").show();c.post(n.attr("action"),n.serialize(),function(w){n.find(".loading").hide();"ok"===w.status?(f=!0,t.val(""),u.val(""),n.find(".c-one-tab").show(),n.find(".c-two-tab").hide(),c("#c-password-block").show()):"fail"===w.status&&u.after('<em class="errormsg">'+w.errors.join("<br />")+"</em>")},"json");return!1});n.find(".c-tab-toggle").click(function(){n.find(".c-one-tab,.c-two-tab").toggle();var w=n.find(".c-password-input");w.is(":visible")&&w.focus();return!1})})();(function(){var n=
c("#tc-api-tokens-filed"),t=n.find(".js-api-tokens-list"),u=!1;n.on("click",".js-remove-api-token",function(w){w.preventDefault();var z=c(this).parents(".js-token-item"),E=z.find(".icon16");w=z.data("token");var B={action:"remove",token_id:w};!u&&w&&confirm(q.remove_ask)&&(u=!0,E.removeClass("no").addClass("loading"),c.post(p,B,function(H){H.status&&"ok"===H.status?(z.remove(),0===t.find(".js-token-item").length&&n.remove()):(u=!1,E.removeClass("loading").addClass("no"))}).always(function(){u=!1;
E.removeClass("loading").addClass("no")}))})})();a.is_own_profile||d(a.wa_url,a.wa_framework_version);a.is_own_profile&&b();(function(){c(".js-webasyst-id-unbind-auth").on("click",function(n){n.preventDefault();window.top.$(".js-webasyst-id-unbind-auth").trigger("wa_waid_unbind_auth",{id:h})})})();(function(){c(".js-webasyst-id-help-link").on("click",function(n){n.preventDefault();window.top.$("body").trigger("wa_waid_help_link")})})();(function(n,t,u){function w(){z(!0)&&E()}function z(y){c("#c-access-rights-hint-warning").hide();
c("#c-access-rights-hint-customize").hide();var C=B.val();void 0===C&&(C="1");switch(C){case "remove":c("#c-credentials-block").hide();c("#c-login-block").hide();c("#c-password-block").hide();if(u){c("#c-access-rights-by-app").hide();c(".c-shown-on-access").hide();break}B.val(D||"0");c("#c-access-rights-hint-warning").show();return!1;case "0":if(e||f)if(e){var x=c("#c-access-rights-by-app");x.show();y&&x.find(".t-access-status").removeClass("type-no type-limited type-full").addClass("type-no");c(".c-shown-on-access").show();
c("#c-login-block").show();c("#c-password-block").show();break}else return c("#c-login-block").show().find(".cancel").one("click.access",function(){B.val(D);w()}).end().find(".c-tab-toggle:first").click(),c("#c-password-block").show(),!1;else return c("#c-credentials-block").show().find(".c-login-input").focus().end().find(".cancel").one("click.access",function(){B.val(D);w()}),!1;case "1":if(e||f)if(e){c("#c-access-rights-by-app").hide();c(".c-shown-on-access").show();c("#c-login-block").show();
c("#c-password-block").show();break}else return c("#c-login-block").show().find(".cancel").one("click.access",function(){B.val(D);w()}).end().find(".c-tab-toggle:first").click(),c("#c-password-block").show(),!1;else return c("#c-credentials-block").show().find(".c-login-input").focus().end().find(".cancel").one("click.access",function(){B.val(D);w()}),!1;default:return!1}n&&(c("#c-login-block").show(),c("#c-password-block").show());D=C;return!0}function E(){function y(x,F,g){return c.post(k+"?module=accessSave&action=rights&id="+
h,{app_id:x,name:F,value:g},"json")}var C=B.val();void 0===C&&(C="1");(function(){switch(C){case "0":return c.post(k+"?module=accessSave&action=makeuser",{id:h},"json").then(function(){return y("webasyst","backend",0)});case "1":return y("webasyst","backend",1);case "remove":return c.post(k+"?module=accessSave&action=revoke",{id:h},"json")}})().then(function(){u&&"0"==C?c("#c-access-rights-hint-customize").show():c("#c-access-rights-hint-warning").hide()})}var B=c("#c-access-rights-toggle"),H=c("#access-rights-toggle-confirm"),
D=B.val();t?c(".c-shown-on-access").hide():c(".c-shown-on-access").show();z();H.on("click",".cancel",function(){B.val(D);H.hide()});H.on("click",".button",function(){H.hide();w()});B.change(function(){if(e){c("#c-access-rights-hint-warning").hide();c("#c-access-rights-hint-customize").hide();var y=B.val();void 0===y&&(y="1");y===D?H.hide():H.show()}else z(!0)})})(a.is_own_profile,a.contact_no_access,a.contact_groups_no_access);new UserAccessTable({$wrapper:c("#c-access-rights-wrapper"),contact_id:h,
is_frame:!0})};window.UserAccessTable=function(a){var b=a.$wrapper,d=a.contact_id,e=a.is_frame||!1;b.on("click",".t-access-status",function(h){h.preventDefault();h=c(this);showAccessDialog(h,h.data("app-id"),d,!0,e)});var f;c(document).on("team_access_level_changed",f=function(h,k){c.contains(document.body,b[0])?b.find('.t-access-status[data-app-id="'+k.app_id+'"]').removeClass("type-no type-limited type-full type-"+k.prev_level).addClass("type-"+k.new_level):c(document).off("team_access_level_changed",
f)})};window.showAccessDialog=function(a,b,d,e,f){a.trigger("close");c.post(c.team.app_url+"?module=access&action=dialog",{user_id:d,app_id:b},function(h){h={html:h};f&&e&&(h.setPosition=function(k){var p=c(window).width();return{top:a.offset().top,left:parseInt((p-k.width)/2)}});new TeamDialog(h)})}})(jQuery);var GroupPage=function(c){GroupPage=function(a){this.$wrapper=a.$wrapper;this.group_id=a.group_id;this.map_adapter=a.map_adapter;this.latitude=a.latitude;this.longitude=a.longitude;this.can_manage=a.can_manage;this.map_is_shown=this.map_is_render=!1;this.initClass()};GroupPage.prototype.initClass=function(){this.bindEvents();this.can_manage&&(this.initEditableName(),this.initEditableDescription());this.initInfoBlock()};GroupPage.prototype.bindEvents=function(){var a=this;if(a.map_adapter&&a.latitude&&
a.longitude)a.$wrapper.on("click",".js-open-map-link",function(){a.showMap()})};GroupPage.prototype.showMap=function(){var a=this.$wrapper.find(".t-map-wrapper");this.map_is_shown?a.slideUp(200):this.map_is_render?a.slideDown(200):(a.show(),this.initMap(),this.map_is_render=!0);this.map_is_shown=!this.map_is_shown};GroupPage.prototype.initMap=function(){var a=this.$wrapper.find("#t-location-map");(new TeamMap(a,this.map_adapter)).render(this.latitude,this.longitude)};GroupPage.prototype.initEditableName=
function(){var a=this,b=a.$wrapper.find(".js-name-editable").first();b.length&&new TeamEditable({$wrapper:b,onSave:function(d){var e=d.$field.val();if(e.length&&d.text!==e){var f=c.team.app_url+"?module=group&action=save",h={"data[id]":a.group_id,"data[name]":e};d.$field.attr("disabled",!0);var k=c('<i class="icon16 loading"></i>').css("margin","0 0 0 4px").insertAfter(d.$field);c.post(f,h,function(){d.$field.attr("disabled",!1);k.remove();d.text=e;d.$wrapper.text(e);d.toggle("hide");c.team.sidebar.reload()})}else e.length||
d.$field.val(d.text),d.toggle("hide")}})};GroupPage.prototype.initEditableDescription=function(){var a=this,b=a.$wrapper.find(".js-desc-editable").first();b.length&&new TeamEditable({$wrapper:b,onSave:function(d){var e=d.$field.val(),f=!e.length;if(d.text!==e){var h=c.team.app_url+"?module=group&action=save",k={"data[id]":a.group_id,"data[description]":e};d.$field.attr("disabled",!0);var p=c('<i class="icon16 loading"></i>').css("margin","0 0 0 4px").insertAfter(d.$field);c.post(h,k,function(){d.$field.attr("disabled",
!1);p.remove();d.is_empty=f;d.text=e;d.$wrapper.text(e);d.toggle("hide");f&&c.team.content.reload()})}else d.toggle("hide")}})};GroupPage.prototype.initInfoBlock=function(){var a=this.$wrapper.find(".t-info-notice-wrapper"),b=new c.store;b.get("team/empty_group_notice_hide")?a.hide():a.show();a.find(".t-info-notice-toggle").on("click",function(){b.set("team/empty_group_notice_hide",1);a.hide()})};return GroupPage}(jQuery),GroupManage=function(c){GroupManage=function(a){this.$wrapper=a.$wrapper;this.$groupUsersW=
this.$wrapper.find(".t-users-list.is-used-list");this.$groupUsersHint=this.$wrapper.find(".t-empty-users-in-group");this.$otherUsersW=this.$wrapper.find(".t-users-list.is-unused-list");this.$otherUsersHint=this.$wrapper.find(".t-empty-users-outside-group");this.group_id=a.group_id;this.hidden_class="is-hidden";this.locales=a.locales;this.xhr=this.is_locked=this.$sidebarLink=!1;this.group_count=this.$groupUsersW.find(".t-user-wrapper").length;this.other_count=this.$otherUsersW.find(".t-user-wrapper").length;
this.initClass()};GroupManage.prototype.initClass=function(){this.bindEvents();this.initAutoComplete();this.initEditableName()};GroupManage.prototype.bindEvents=function(){var a=this;a.$wrapper.on("click",".js-edit-group",function(b){b.preventDefault();a.group_id&&!a.is_locked&&a.showEditGroupDialog()});a.$wrapper.on("click",".js-delete-group",function(b){b.preventDefault();a.group_id&&!a.is_locked&&a.showDeleteDialog()});a.$groupUsersW.on("click",".js-move-user",function(b){b.preventDefault();a.is_locked||
a.moveUser(c(this).closest(".t-user-wrapper"),!1)});a.$otherUsersW.on("click",".js-move-user",function(b){b.preventDefault();a.is_locked||a.moveUser(c(this).closest(".t-user-wrapper"),!0)})};GroupManage.prototype.showEditGroupDialog=function(){var a=this,b={id:a.group_id};a.is_locked||(a.is_locked=!0,a.xhr&&(a.xhr.abort(),a.xhr=!1),a.xhr=c.get("?module=group&action=edit",b,function(d){new TeamDialog({html:d});a.is_locked=!1}))};GroupManage.prototype.showDeleteDialog=function(){var a=this,b=c.team.app_url+
"?module=group&action=deleteConfirm",d={id:a.group_id};a.is_locked||(a.is_locked=!0,a.xhr&&(a.xhr.abort(),a.xhr=!1),a.xhr=c.get(b,d,function(e){new TeamDialog({html:e});a.is_locked=!1;a.$wrapper.trigger("close")}))};GroupManage.prototype.moveUser=function(a,b){var d=this,e={user_id:a.data("user-id"),group_id:d.group_id};if(!d.is_locked){d.xhr&&(d.xhr.abort(),d.xhr=!1);var f=b?c.team.app_url+"?module=group&action=userAdd":c.team.app_url+"?module=group&action=userRemove";d.xhr=c.post(f,e,function(h){"ok"==
h.status&&(b?(d.$groupUsersW.append(a),d.group_count++,d.other_count--):(d.$otherUsersW.prepend(a),d.group_count--,d.other_count++),0>=d.group_count?(d.$groupUsersW.addClass(d.hidden_class),d.$groupUsersHint.removeClass(d.hidden_class)):(d.$groupUsersW.removeClass(d.hidden_class),d.$groupUsersHint.addClass(d.hidden_class)),0>=d.other_count?(d.$otherUsersW.addClass(d.hidden_class),d.$otherUsersHint.removeClass(d.hidden_class)):(d.$otherUsersW.removeClass(d.hidden_class),d.$otherUsersHint.addClass(d.hidden_class)),
d.setCount(d.group_count));d.is_locked=!1})}};GroupManage.prototype.setCount=function(a){var b=c.team.app_url+"group/"+this.group_id+"/";this.$sidebarLink||(this.$sidebarLink=c.team.sidebar.$wrapper.find('a[href="'+b+'"] '));if(this.$sidebarLink.length){var d=this.$sidebarLink.closest("li");d.find(".indicator").remove();d.find(".count").text(a);c.team.sidebar.saveCount(b,a)}};GroupManage.prototype.initAutoComplete=function(){function a(){clearTimeout(h);f.length&&(f.remove(),f=!1)}function b(k){f=
c('<span class="t-hint"><i class="icon16 yes"></i>'+k+"</span>");e.after(f);h=setTimeout(a,1E3)}var d=this,e=d.$wrapper.find(".t-autocomplete-wrapper .t-input"),f=!1,h=0;e.autocomplete({source:function(k,p){var q=c.team.app_url+"?module=autocomplete&type=user";k={term:k.term};d.group_id&&(k.group_id=d.group_id);c.post(q,k,function(n){p(n)},"json")},minLength:2,open:function(){a()},focus:function(){return!1},select:function(k,p){p.item.id&&(k=d.$otherUsersW.find('.t-user-wrapper[data-user-id="'+p.item.id+
'"]'),k.length?(k.find(".js-move-user").click(),b(d.locales.added)):b(d.locales.in_group));e.val("");return!1}})};GroupManage.prototype.initEditableName=function(){var a=this,b=a.$wrapper.find(".js-name-editable").first();b.length&&new TeamEditable({$wrapper:b,onSave:function(d){var e=d.$field.val();if(e.length&&d.text!==e){var f=c.team.app_url+"?module=group&action=save",h={"data[id]":a.group_id,"data[name]":e};d.$field.attr("disabled",!0);var k=c('<i class="icon16 loading"></i>').css("margin","0 0 0 4px").insertAfter(d.$field);
c.post(f,h,function(){d.$field.attr("disabled",!1);k.remove();d.text=e;d.$wrapper.text(e);d.toggle("hide");c.team.sidebar.reload()})}else e.length||d.$field.val(d.text),d.toggle("hide")}})};return GroupManage}(jQuery),GroupEditDialog=function(c){GroupEditDialog=function(a){this.$wrapper=a.$wrapper;this.$block=this.$wrapper.find(".t-dialog-block");this.$form=this.$block.find("form");this.$iconToggle=this.$block.find(".t-icon-toggle");this.$addressToggle=this.$block.find(".t-address-toggle");this.$mapToggle=
this.$block.find(".t-map-toggle");this.$submitButton=this.$form.find('input[type="submit"]');this.selected_class="is-selected";this.hidden_class="is-hidden";this.has_error_class="error";this.locales=a.locales;this.dialog=this.$wrapper.data("teamDialog");this.$activeType=this.$block.find(".t-type-toggle ."+this.selected_class);this.$activeIcon=this.$iconToggle.find("."+this.selected_class);this.is_locked=!1;this.save_timeout=0;this.is_map_loading=!1;this.bindEvents();this.teamMap=this.initMap(a.map_type||
"google")};GroupEditDialog.prototype.bindEvents=function(){var a=this;a.$block.on("click",".t-type-toggle .t-toggle-item",function(b){b.stopPropagation();a.setType(c(this))});a.$iconToggle.on("click",".t-icon-item",function(b){b.preventDefault();a.setIcon(c(this))});a.$form.on("submit",function(b){b.preventDefault();a.is_locked||(a.$form.find(".js-submit-loading").remove(),a.$submitButton.parent().append("<i class='icon16 loading js-submit-loading'></i>"),a.save())});a.$form.find("input, textarea").on("mousedown",
function(){var b=c(this),d=b.hasClass(a.has_error_class);a.$form.find(".js-submit-loading").remove();d&&b.removeClass(a.has_error_class).closest(".value").find(".t-error").remove()})};GroupEditDialog.prototype.setType=function(a){var b=a.data("type");if(a.hasClass(this.selected_class))return!1;this.$activeType.length&&this.$activeType.removeClass(this.selected_class);"group"==b?(this.$iconToggle.removeClass(this.hidden_class),this.$addressToggle.addClass(this.hidden_class),this.$mapToggle.addClass(this.hidden_class)):
(this.$iconToggle.addClass(this.hidden_class),this.$addressToggle.removeClass(this.hidden_class),this.$mapToggle.removeClass(this.hidden_class));a.addClass(this.selected_class);this.$activeType=a;this.dialog.resize()};GroupEditDialog.prototype.setIcon=function(a){var b=a.data("icon-class");if(a.hasClass(this.selected_class))return!1;this.$activeIcon.length&&this.$activeIcon.removeClass(this.selected_class);this.$form.find('input[name="data[icon]"]').val(b).trigger("change");a.addClass(this.selected_class);
this.$activeIcon=a};GroupEditDialog.prototype.save=function(a){function b(q){function n(w){d.$form.find(".t-error").remove();c.each(w,function(z,E){z=d.$form.find("[name='"+E.field+"']");z.length&&z.addClass(d.has_error_class).after('<span class="t-error">'+d.locales[E.locale]+"</span>")})}var t={},u=[];c.each(q,function(w,z){t[z.name]=z.value});c.trim(t["data[name]"]).length||u.push({field:"data[name]",locale:"empty"});return u.length?(n(u),!1):t}var d=this,e;a=a||0;if(!d.is_locked)if(d.is_locked=
!0,e=b(d.$form.serializeArray())){if(d.is_map_loading&&5>a)return d.is_locked=!1,d.save_timeout=setTimeout(function(){c.contains(document,d.$wrapper[0])&&d.save(a+1)},1E3),!1;var f=function(){c.post("?module=group&action=save",e,function(q){"ok"==q.status&&(c.team.content.load(c.team.app_url+"group/"+q.data.id+"/manage/"),c.team.sidebar.reload(),d.is_locked=!1)})},h=e["data[location][address]"],k=e["data[location][latitude]"],p=e["data[location][longitude]"];!h||k&&p||!d.teamMap?f():d.teamMap.geocode(h,
function(q,n){e["data[location][latitude]"]=q;e["data[location][longitude]"]=n;f()},function(){f()})}else d.is_locked=!1};GroupEditDialog.prototype.initMap=function(a){function b(w){function z(E,B){p.is(":hidden")&&(p.show(),e.data("top",e.offset().top),e.css("top",e.data("top")-p.height()/2));u.render(E,B);k.val(E);h.val(B)}clearTimeout(n);"string"===c.type(w)?(d.is_map_loading=!0,u.geocode(w,function(E,B){k.val(E);h.val(B);q.hide();z(E,B);d.is_map_loading=!1},function(){p.hide();h.val("");k.val("");
q.show();d.is_map_loading=!1})):z(w.lat,w.lng)}var d=this,e=d.$block,f=d.$addressToggle.find(".f-location-edit-address-input"),h=d.$addressToggle.find(".t-location-longitude-input"),k=d.$addressToggle.find(".t-location-latitude-input"),p=d.$mapToggle.find(".t-location-edit-map"),q=d.$addressToggle.find(".t-map-hint"),n=0;if(0<f.length){var t=d.$form.find(".value").first().width();p.width(t);p.height(t/1.618)}var u=new TeamMap(p,a);a=h.val();t=k.val();a&&t&&b({lat:t,lng:a});f.on("change",function(){var w=
c(this).val();w.length?b(w):(h.val(""),k.val(""),p.hide())});f.on("keyup",function(){clearTimeout(n);var w=c(this).val();w.length?(d.is_map_loading=!0,n=setTimeout(function(){b(w)},1E3)):(h.val(""),k.val(""),p.hide())});return u};return GroupEditDialog}(jQuery),GroupDeleteDialog=function(c){GroupDeleteDialog=function(a){this.$wrapper=a.$wrapper;this.$block=this.$wrapper.find(".t-dialog-block");this.api_enabled=window.history&&window.history.replaceState;this.group_id=a.group_id;this.is_locked=!1;
this.initClass()};GroupDeleteDialog.prototype.initClass=function(){var a=this;a.$block.on("click",".js-delete-event",function(b){b.preventDefault();if(!a.is_locked)a["delete"]()})};GroupDeleteDialog.prototype["delete"]=function(){var a=this,b={id:a.group_id};a.is_locked=!0;c.post("?module=group&action=delete",b,function(d){"ok"==d.status&&(a.$wrapper.trigger("close"),a.api_enabled?(history.state.content_uri=c.team.app_url,history.replaceState({reload:!0,content_uri:c.team.app_url},"",c.team.app_url),
c.team.sidebar.reload(),c.team.content.reload()):location.href=c.team.app_url)},"json")};return GroupDeleteDialog}(jQuery);var SettingsPage=function(c){SettingsPage=function(a){this.$wrapper=a.$wrapper;this.$calendarToggle=this.$wrapper.find("#t-calendar-settings");this.$form=this.$wrapper.find("form");this.$submitButton=c(document).find('.bottombar [type="submit"]');this.locales=a.locales;this.xhr=this.is_form_changed=this.is_locked=this.$notice=!1;this.initClass()};SettingsPage.prototype.initClass=function(){this.bindEvents();this.initSortable()};SettingsPage.prototype.bindEvents=function(){var a=this;a.$calendarToggle.on("click",
".js-edit-calendar",function(b){b.preventDefault();(b=parseInt(c(this).closest(".t-calendar-item").data("id")))&&a.showEditDialog(b)});a.$calendarToggle.on("click",".js-add-calendar",function(b){b.preventDefault();a.showEditDialog()});a.$form.on("submit",function(b){b.preventDefault();a.is_form_changed&&a.save(a.$form)});a.$form.on("change","input, select, textarea",function(){a.is_form_changed||(a.is_form_changed=!0,a.$submitButton.addClass("yellow"))})};SettingsPage.prototype.initSortable=function(){var a=
this;a.$calendarToggle.sortable({animation:150,handle:".t-toggle",direction:"vertical",filter:".t-actions",onMove:function(b){if(b.related.classList.contains("t-actions"))return-1},onStart:function(){a.$notice&&(a.$notice.remove(),a.$notice=!1)},onEnd:function(b){b.oldIndex!==b.newIndex&&a.saveCalendarsSort(b.item)}})};SettingsPage.prototype.showEditDialog=function(a){var b=this,d=c.team.app_url+"?module=calendar",e={};a&&(e.id=a);b.xhr&&(b.xhr.abort(),b.xhr=!1);b.xhr=c.post(d,e,function(f){b.dialog=
c.waDialog({html:f})})};SettingsPage.prototype.saveCalendarsSort=function(a){function b(h){var k=c('<span class="t-notice state-success">&nbsp;<i class="fas fa-check-circle"></i>&nbsp;'+(d.locales.saved||"")+"</span>");k.appendTo(h);return k}var d=this,e=c(a);a=c.team.app_url+"?module=settings&action=calendarsSortSave";var f={calendars:function(){var h=[];d.$calendarToggle.find(".t-calendar-item").each(function(){var k=c(this).data("id");k&&0<k&&h.push(k)});return h}()};d.xhr&&(d.xhr.abort(),d.xhr=
!1);d.$notice=function(h){var k=c('<span class="t-notice">&nbsp;<i class="fas fa-spin fa-spinner"></i>&nbsp;'+(d.locales.saving||"")+"</span>");k.appendTo(h);return k}(e);d.xhr=c.post(a,f,function(h){d.$notice.remove();d.$notice=b(e);setTimeout(function(){d.$notice&&c.contains(document,d.$notice[0])&&d.$notice.remove()},1E3);d.xhr=!1})};SettingsPage.prototype.save=function(a){var b=this,d=c.team.app_url+"?module=settings&action=save";a=a.serializeArray();var e=b.$submitButton.text();b.$submitButton.html(e+
'&nbsp;<i class="fas fa-spin fa-spinner"></i>');b.is_locked||(b.is_locked=!0,c.post(d,a,function(f){b.is_form_changed=!1;b.$submitButton.removeClass("yellow");"ok"===f.status&&("google"===f.data.map_info.adapter?c.getScript("https://maps.googleapis.com/maps/api/js?sensor=false&key="+(f.data.map_info.settings.key||"")+"&lang="+f.data.lang):"yandex"===f.data.map_info.adapter&&c.getScript("https://api-maps.yandex.ru/2.1/?apikey="+(f.data.map_info.settings.apikey||"")+"&lang="+f.data.lang))}).always(function(){b.$submitButton.text(e);
b.is_locked=!1}))};return SettingsPage}(jQuery),CalendarEditDialog=function(c){CalendarEditDialog=function(a){this.$wrapper=a.$wrapper;this.$form=this.$block=this.$wrapper.find(".dialog-body");this.$styleWrapper=this.$block.find(".t-style-wrapper");this.$iconsWrapper=this.$block.find(".t-calendar-icons");this.$limitedToggle=this.$block.find(".t-limited-toggle");this.$colorToggle=this.$block.find(".t-color-toggle");this.$nameField=this.$block.find('input[name="data[name]"]');this.$iconField=this.$block.find('input[name="data[icon]"]');
this.$badge_status=this.$block.find(".js-badge-preview.is-status");this.$badge_event=this.$block.find(".js-badge-preview.is-event");this.calendar_id=a.calendar_id;this.selected_class="is-selected";this.hidden_class="is-hidden";this.has_error_class="state-error";this.locales=a.locales;this.teamDialog=this.$wrapper.data("dialog");this.$selectedStyleButton=this.$styleWrapper.find("."+this.selected_class);this.xhr=this.is_locked=!1;this.initClass()};CalendarEditDialog.prototype.initClass=function(){this.bindEvents();
this.initColorPicker()};CalendarEditDialog.prototype.bindEvents=function(){var a=this;a.$block.on("click",".js-delete-calendar",function(b){b.preventDefault();a.is_locked||a.showDeleteConfirm()});a.$styleWrapper.on("click",".t-style-item",function(b){b.preventDefault();a.setStyleToggle(c(this))});a.$styleWrapper.on("click",".js-custom-color",function(b){b.preventDefault();c(this).find("svg").toggleClass("fa-caret-down fa-caret-up");a.$colorToggle.toggleClass("hidden")});a.$iconsWrapper.on("click",
".t-calendar-icons--item",function(b){b.preventDefault();b=c(this);var d=b.find("svg");d=d.attr("data-prefix")+" fa-"+d.attr("data-icon");b.addClass(a.selected_class).siblings().removeClass(a.selected_class);a.$badge_status.find("*:not(span)").remove().end().prepend('<i class="'+d+'"></i>');a.$badge_event.find("*:not(span)").remove().end().prepend('<i class="'+d+'"></i>');a.$iconField.val(d)});a.$block.on("click",".js-custom-icon",function(b){b.preventDefault();c(this).find("svg").toggleClass("fa-caret-down fa-caret-up");
a.$iconField.attr("type",function(d,e){return"hidden"==e?"text":"hidden"})});a.$form.on("submit",function(b){b.preventDefault();a.locked||a.save()});a.$form.on("change",".t-color-field",function(){a.$selectedStyleButton.length&&(a.$selectedStyleButton.removeClass(a.selected_class),a.$selectedStyleButton=!1)});a.$form.find("input, textarea").on("mousedown",function(){var b=c(this);b.hasClass(a.has_error_class)&&b.removeClass(a.has_error_class).closest(".value").find(".state-error-hint").remove()});
a.$nameField.on("change keyup",function(){var b=c(this).val();b=b.length?b:a.locales.preview;a.setPreviewName(b)});a.$limitedToggle.on("change","input:radio",function(){var b=a.$limitedToggle.find(".t-hidden-content");c(this).val().length?b.show():b.hide();a.teamDialog.resize()})};CalendarEditDialog.prototype.setStyleToggle=function(a){var b=a.css("background-color"),d=a.css("color"),e=this.colorConvert(b,40).hex,f=this.colorConvert(b,-15).hex;this.$selectedStyleButton.length&&this.$selectedStyleButton.removeClass(this.selected_class);
this.setStyleData(b,d);a.addClass(this.selected_class);this.$selectedStyleButton=a;this.$badge_status.css({"background-color":e,color:f});this.$badge_event.css({"background-color":b,color:d});this.$styleWrapper.find('[name="data[status_bg_color]"]').val(e);this.$styleWrapper.find('[name="data[status_font_color]"]').val(f)};CalendarEditDialog.prototype.setStyleData=function(a,b){function d(e){e=e.split("(")[1].split(")")[0];e=e.split(",").splice(0,3);return"#"+e.map(function(f){f=parseInt(f).toString(16);
return 1==f.length?"0"+f:f}).join("")}a.includes("#")||(a=d(a));b.includes("#")||(b=d(b));this.$form.find('[name="data[bg_color]"]').val(a).trigger("change");this.$form.find('[name="data[font_color]"]').val(b).trigger("change");this.$form.find('[name="data[status_bg_color]"]').val(this.colorConvert(a,40).hex).trigger("change");this.$form.find('[name="data[status_font_color]"]').val(this.colorConvert(a,-15).hex).trigger("change")};CalendarEditDialog.prototype.showDeleteConfirm=function(){var a=this,
b={id:a.calendar_id};a.is_locked=!0;a.xhr&&(a.xhr.abort(),a.xhr=!1);a.xhr=c.get("?module=calendar&action=deleteConfirm",b,function(d){c.waDialog({html:d});a.is_locked=!1;a.teamDialog.close()})};CalendarEditDialog.prototype.initColorPicker=function(){var a=this,b=function(){b=function(d){this.$wrapper=d.$wrapper;this.$field=this.$wrapper.querySelector(".t-color-field");this.$pick_color_btn=this.$wrapper.querySelector(".js-show-color-picker");this.pickr_options={el:this.$pick_color_btn,theme:"classic",
appClass:"wa-pcr-app small",lockOpacity:!0,position:"right-start",useAsButton:!0,container:a.$wrapper[0],default:this.$field.value||"#42445a",components:{palette:!0,hue:!0}};this.initClass()};b.prototype.initClass=function(){function d(f){f=f.hasOwnProperty("toHEXA")?f.toHEXA().toString(0):f.target.value;e.$field.value=f;e.$pick_color_btn.style.backgroundColor=f;e.$pick_color_btn.classList.contains("js-bg-color")&&(a.$badge_event[0].style.backgroundColor=f,a.$badge_status[0].style.backgroundColor=
a.colorConvert(f,40).hex,a.$badge_status[0].style.color=f,a.$form[0].querySelector('[name="data[status_bg_color]"]').value=a.colorConvert(f,40).hex,a.$form[0].querySelector('[name="data[status_font_color]"]').value=a.colorConvert(f,-15).hex);e.$pick_color_btn.classList.contains("js-font-color")&&(a.$badge_event[0].style.color=f)}var e=this;Pickr.create(e.pickr_options).on("change",function(f){return d(f)}).on("changestop",function(f,h){return h.hide()});e.$wrapper.dataset.colorPicker=e;e.$field.addEventListener("keyup",
d,!1)};return b}();a.$styleWrapper.find(".t-color-toggle .t-toggle").each(function(){new b({$wrapper:this})})};CalendarEditDialog.prototype.setPreviewName=function(a){this.$block.find(".js-badge-preview > span").text(a)};CalendarEditDialog.prototype.colorConvert=function(a,b){b=void 0===b?0:b;var d=0,e=0,f=0;a.includes("#")?4==a.length?(d="0x"+a[1]+a[1],e="0x"+a[2]+a[2],f="0x"+a[3]+a[3]):7==a.length&&(d="0x"+a[1]+a[2],e="0x"+a[3]+a[4],f="0x"+a[5]+a[6]):(f=a.split("(")[1].split(")")[0].split(",").splice(0,
3),d=f[0],e=f[1],f=f[2]);d/=255;e/=255;f/=255;var h=Math.min(d,e,f),k=Math.max(d,e,f),p=k-h,q=0,n=a=0;q=0==p?0:k==d?(e-f)/p%6:k==e?(f-d)/p+2:(d-e)/p+4;q=Math.round(60*q);0>q&&(q+=360);n=(k+h)/2;a=0==p?0:p/(1-Math.abs(2*n-1));a=+(100*a).toFixed();n=+(100*n).toFixed();0!==b&&(50<=n&&(n-=20),0<b?(n+=parseInt(b,10),100<=n&&(n-=10)):0>b&&(n+=parseInt(b,10)));b={hsl:"hsl("+q+","+a+"%,"+n+"%)"};n/=100;var t=a*Math.min(n,1-n)/100;d=function(u){u=(u+q/30)%12;return Math.round(255*(n-t*Math.max(Math.min(u-
3,9-u,1),-1))).toString(16).padStart(2,"0")};b.hex="#"+d(0)+d(8)+d(4);return b};CalendarEditDialog.prototype.save=function(){var a=this,b=function(d){function e(k){a.$form.find(".state-error-hint").remove();c.each(k,function(p,q){p=a.$form.find("[name='"+q.field+"']");p.length&&p.addClass(a.has_error_class).after('<span class="state-error-hint">'+a.locales[q.locale]+"</span>")})}var f={},h=[];c.each(d,function(k,p){f[p.name]=p.value});f["data[is_limited]"]||delete f["data[is_limited]"];c.trim(f["data[name]"]).length||
h.push({field:"data[name]",locale:"empty"});return h.length?(e(h),!1):f}(a.$form.serializeArray());a.is_locked||(a.is_locked=!0,b?c.post("?module=calendar&action=save",b,function(d){"ok"==d.status&&(c.team.content.reload(),c.team.sidebar.reload(),a.is_locked=!1,a.teamDialog.close())}):a.is_locked=!1)};return CalendarEditDialog}(jQuery),CalendarDeleteDialog=function(c){CalendarDeleteDialog=function(a){this.$wrapper=a.$wrapper;this.$block=this.$wrapper.find(".dialog-body");this.calendar_id=a.calendar_id;
this.is_locked=!1;this.initClass()};CalendarDeleteDialog.prototype.initClass=function(){var a=this;a.$block.on("click",".js-delete-calendar",function(b){b.preventDefault();if(!a.is_locked)a["delete"]()})};CalendarDeleteDialog.prototype["delete"]=function(){var a=this,b={id:a.calendar_id};a.is_locked=!0;c.post("?module=calendar&action=delete",b,function(d){"ok"==d.status&&(c.team.content.reload(),a.$wrapper.data("dialog").close())},"json")};return CalendarDeleteDialog}(jQuery);var SiteApiTokenPage=function(c){SiteApiTokenPage=function(a){this.$wrapper=a.$wrapper;this.locale=a.locale;this.initClass()};SiteApiTokenPage.prototype.initClass=function(){this.initRemoveApiToken()};SiteApiTokenPage.prototype.initRemoveApiToken=function(){var a=this,b=a.$wrapper.find(".js-api-tokens-list"),d;a.$wrapper.on("click",".js-remove-api-token",function(e){e.preventDefault();var f=c(this).parents(".js-token-item"),h=f.find("svg");e=f.data("token");var k=f.data("contact-id");k={action:"remove",
token_id:e,contact_id:k};!d&&e&&confirm(a.locale.remove_ask)&&(d=!0,h.removeClass("fa-times").addClass("fa-spin fa-spinner"),c.post("?module=apiTokensRemove",k,function(p){p.status&&"ok"===p.status?(f.remove(),b.find(".js-token-item")):(d=!1,h.removeClass("fa-spin fa-spinner").addClass("fa-times"))}).always(function(){d=!1;h.removeClass("fa-spin fa-spinner").addClass("fa-times")}))})};return SiteApiTokenPage}(jQuery);var UserList=function(c){UserList=function(a){this.$wrapper=a.$wrapper;this.$items=this.$wrapper.find(".t-user-wrapper");this.xhr=this.is_locked=!1;this.initClass()};UserList.prototype.initClass=function(){this.initHightlight();this.bindEvents()};UserList.prototype.bindEvents=function(){var a=!1;this.$wrapper.find(".js-move-user").draggable({helper:"clone",delay:200,cursorAt:{top:10,left:20},start:function(b,d){d.helper.addClass("is-clone");a=c.team.sidebar.$wrapper.find(".js-drop-block");a.length&&
a.addClass("t-drop-here")},stop:function(b,d){b=d.helper;var e=b.clone();e.insertAfter(b).fadeOut(270);setTimeout(function(){e.remove()},300);a.length&&a.removeClass("t-drop-here")}})};UserList.prototype.initHightlight=function(){function a(d){return new Date(d.year,d.month-1,d.day,d.hours,d.minutes,d.seconds)}var b=c.team.sidebar.link_count_update_date;b&&(b=a(b),this.$items.each(function(){var d=c(this),e=d.data("update-datetime");if(e&&e.length){var f=e.split(" ");e=f[0].split("-");f=f[1].split(":");
e={year:parseInt(e[0]),month:parseInt(e[1]),day:parseInt(e[2]),hours:parseInt(f[0]),minutes:parseInt(f[1]),seconds:parseInt(f[2])};a(e)>b&&d.addClass("highlighted")}}))};return UserList}(jQuery);var WelcomePage=function(c){WelcomePage=function(a){this.$wrapper=a.$wrapper;this.$inviteWrapper=this.$wrapper.find("#t-invite-wrapper");this.$inviteList=this.$inviteWrapper.find(".t-invite-list");this.locales=a.locales;this.error_class="state-error";this.is_locked=!1;this.switch_count=3;this.initClass()};WelcomePage.prototype.initClass=function(){c(document).on("ready",function(){c.team.content.is_enabled=!1});this.initWaSwitch();this.bindEvents()};WelcomePage.prototype.bindEvents=function(){var a=
this;a.$wrapper.on("click",".js-skip-page",function(b){b.stopPropagation()});a.$wrapper.on("click",".js-send-invites",function(b){b.preventDefault();a.is_locked||a.sendInvites()});a.$inviteWrapper.on("click",".js-add-invite",function(b){b.preventDefault();a.addNewInvite()});a.$inviteWrapper.on("click",".js-remove-invite",function(b){b.preventDefault();c(this).closest("li").remove()});a.$inviteWrapper.on("click","."+a.error_class,function(){a.removeErrors(c(this))})};WelcomePage.prototype.initWaSwitch=
function(){this.$inviteWrapper.find(".js-access-switch").waSwitch({ready:function(a){a.$label=a.$wrapper.siblings("label");a.active_text=a.$label.data("active-text");a.inactive_text=a.$label.data("inactive-text")},change:function(a,b){b.$label.text(a?b.active_text:b.inactive_text)}})};WelcomePage.prototype.addNewInvite=function(){var a=this.$inviteWrapper.find(".t-invite-template").clone().html();a=c("<li>"+a+"</li>");this.switch_count+=1;a.find('[type="checkbox"]').attr("id","access_switch_"+this.switch_count);
a.find("label").attr("for","access_switch_"+this.switch_count);this.$inviteList.append(a);this.initWaSwitch()};WelcomePage.prototype.sendInvites=function(){function a(f){var h=[];c.each(f,function(k,p){k=p.text;p=parseInt(p.name.replace("data[","").replace("][email]",""));p=b.$inviteList.find(".t-invite-item").eq(p).find(".t-field");p.length&&h.push({$field:p,locale:k})});b.displayErrors(h)}var b=this,d=c.team.app_url+"?module=welcome&action=save",e=function(){var f=[],h=[];b.$inviteList.find(".t-invite-item").each(function(k){var p=
c(this).find('[type="email"]'),q=c(this).find('[type="checkbox"]'),n=p.val();q=q.prop("checked");c.trim(n).length&&(n.match(".+@.+")?(f.push({name:"data["+k+"][email]",value:n}),f.push({name:"data["+k+"][access]",value:q})):h.push({$field:p,locale:b.locales.incorrect}))});return h.length?(b.displayErrors(h),!1):f.length?f:!1}();b.is_locked=!0;e?c.post(d,e,function(f){f.errors&&f.errors.length?a(f.errors):location.href=c.team.app_url}).always(function(){b.is_locked=!1}):b.is_locked=!1};WelcomePage.prototype.removeErrors=
function(a){var b=this.error_class;a?(a.removeClass(b),a.parent().find(".state-error-hint").remove()):(this.$inviteList.find(".state-error-hint").remove(),this.$inviteList.find("."+b).removeClass(b))};WelcomePage.prototype.displayErrors=function(a){var b=this.error_class;this.removeErrors();c.each(a,function(d,e){d='<span class="state-error-hint" style="position:absolute;bottom:-.5625rem;left:0;">'+e.locale+"</span>";e.$field.addClass(b).before(d)})};return WelcomePage}(jQuery);var LongActionProcess=function(c){var a="",b="",d=500,e=750,f=[],h={},k=null,p,q,n,t,u,w,z,E,B=!1,H=function(){for(;0<f.length;){var x=f.shift();x&&clearTimeout(x)}},D=function(){var x=c.extend(!0,{},h);x.processId=b;x.cleanup=1;c.post(a,x,function(F){p&&p(F)}).always(function(){H()})},y=function(x){B||(x=x||d,x=setTimeout(function(){var F=c.extend(!0,{},h);F.processId=b;c.post(a,F,function(g){g?g.ready?(q&&q.call(k,g),D()):g.error?t&&t.call(k,g):g.progress?(n&&n.call(k,g),y()):g.warning?(u&&u.call(k,
g),y()):y(e):y(e);E&&E.call(k,g)},"json").error(function(){y(e)})},x),f.push(x))},C=function(x){if(!x.url)throw Error("Url is required");a=x.url;d=x.step_delay||d;e=x.rest_delay||e;h=x.post_data||h;p=x.onCleanup;q=x.onReady;n=x.onProgress;t=x.onError;u=x.onWarning;w=x.onStart;z=x.onStop;E=x.onAlways;k=this};c.extend(C.prototype,{start:function(){w&&w();var x=c.extend(!0,{},h);c.post(a,x,function(F){F&&F.processId?(b=F.processId,y(100),y(200)):F&&F.error?t&&t.call(k,F):t&&t.call(k,"Server error")},
"json").error(function(){t&&t.call(k,"Server error")})},stop:function(){B=!0;z&&z.call(k);H()}});return C}(jQuery);var TeamMap=function(c){var a=function(b,d,e){if(!b)throw Error("DOM element is required");this.$map=c(b);(this.provider=d)&&0>["google","yandex","disabled"].indexOf(this.provider)&&console.error("Not supported map provider: %s".replace("%s",this.provider));this.map_info=null;this.initClass()};a.prototype.initClass=function(){};a.prototype.render=function(b,d){switch(this.provider){case "google":return this.googleRender(b,d);case "yandex":return this.yandexRender(b,d)}};a.prototype.googleRender=function(b,
d){var e=this;e.map_info=e.map_info||{};b=new google.maps.LatLng(b,d);e.map_info.map||(d={zoom:12,center:b,mapTypeId:google.maps.MapTypeId.ROADMAP},e.map_info.map=new google.maps.Map(e.$map.get(0),d));e.map_info.marker&&e.map_info.marker.setMap(null);e.map_info.marker=new google.maps.Marker({position:b,map:e.map_info.map});e.map_info.map.setCenter(b);a.google_error_html=a.google_error_html||"";setTimeout(function(){if(e.$map.find(".gm-err-container").length)e.$map.find(".gm-err-container").find(".gm-err-message").last().after('<div class="gm-err-message">'+
c.team.locales.map_check_your_key+"</div>"),a.google_error_html=e.$map.find(".gm-err-container").parent().html();else if(!e.$map.find(".gm-style").length)if(a.google_error_html)e.$map.children().html(a.google_error_html);else{var f='<div class="gm-err-container"><div class="gm-err-content"><div class="gm-err-icon"><img src="https://maps.gstatic.com/mapfiles/api-3/images/icon_error.png" draggable="false" style="user-select: none;"></div><div class="gm-err-title">:title:</div><div class="gm-err-message">:message1:</div><div class="gm-err-message">:message2:</div></div></div>'.replace(":title:",
c.team.locales.map_error_title);f=f.replace(":message1:",c.team.locales.map_error_message);f=f.replace(":message2:",c.team.locales.map_check_your_key);e.$map.children().html(f)}},5E3)};a.prototype.yandexRender=function(b,d){this.map_info=this.map_info||{};b=[b,d];this.map_info.map||(d={zoom:12,center:b,controls:["zoomControl","fullscreenControl"]},this.map_info.map=new ymaps.Map(this.$map.get(0),d));this.map_info.marker&&this.map_info.map.geoObjects.remove(this.map_info.marker);this.map_info.marker=
new ymaps.Placemark(b);this.map_info.map.geoObjects.add(this.map_info.marker);this.map_info.map.setCenter(b)};a.prototype.geocode=function(b,d,e){switch(this.provider){case "google":return this.googleGeocode(b,d,e);case "yandex":return this.yandexGeocode(b,d,e);default:e?e():d&&d()}};a.prototype.googleGeocode=function(b,d,e){var f=!1,h=!1;(new google.maps.Geocoder).geocode({address:b},function(k,p){f=!0;h||(p==google.maps.GeocoderStatus.OK?(k=k[0].geometry.location,d(k.lat(),k.lng())):e&&e())});setTimeout(function(){f||
(h=!0,e&&e(!0))},5E3)};a.prototype.yandexGeocode=function(b,d,e){ymaps.geocode(b,{results:1}).then(function(f){var h=1;f.metaData&&f.metaData.geocoder&&"found"in f.metaData.geocoder&&(h=f.metaData.geocoder.found);0>=h?e():(f=f.geoObjects.get(0).geometry.getCoordinates(),d(f[0],f[1]))},function(f){e(f)})};return a}(jQuery);var SwiperSlider=function(c){this.container=c.selector||".swiper-container";this.params=c.params||{};this.events=c.events||{};this.calculate_group_size=c.calculateGroupSize||!1;this.watch_nav=c.watchNav||!1;this.set_container_width=c.setContainerWidth||!1;this.swiper={};this.init()};
SwiperSlider.prototype.init=function(){var c=this;c.params.on={beforeInit:function(a){c.calculate_group_size&&(a.params.slidesPerGroup=c.calculateGroupSize(a),a.params.slidesPerView=c.calculateGroupSize(a));c.set_container_width&&c.setContainerWidth(a)},init:function(a){}};c.swiper=new Swiper(c.container,c.params);c.bindEvents();c.watch_nav&&c.showNavigation();c.set_container_width&&c.setContainerWidth(c.swiper)};
SwiperSlider.prototype.setContainerWidth=function(c){var a=this;c.on("beforeResize",function(){a.set_container_width.forEach(function(b){var d=document.body.clientWidth;d<=b?c.$el.css("width",d+"px"):c.$el.css("width","")})})};
SwiperSlider.prototype.showNavigation=function(){var c=this,a=c.swiper.navigation.prevEl,b=c.swiper.navigation.nextEl;a&&b&&(a.classList.toggle("hidden",c.swiper.isLocked),b.classList.toggle("hidden",c.swiper.isLocked),c.swiper.on("lock unlock",function(){a.classList.toggle("hidden",c.swiper.isLocked);b.classList.toggle("hidden",c.swiper.isLocked)}))};
SwiperSlider.prototype.calculateGroupSize=function(c){var a=c.el.clientWidth-(c.params.slidesOffsetBefore||0)-(c.params.slidesOffsetAfter||0);c=c.wrapperEl.querySelector("."+c.params.slideClass).clientWidth;return Math.round(a/c)};SwiperSlider.prototype.bindEvents=function(){for(var c in this.events)if(this.events.hasOwnProperty(c))this.swiper.on(c,this.events[c])};
//# sourceMappingURL=team.min.js.map